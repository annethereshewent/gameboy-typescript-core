"use strict";var __extends=this&&this.__extends||function(){var v=function(s,l){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])},v(s,l)};return function(s,l){if(typeof l!="function"&&l!==null)throw new TypeError("Class extends value "+String(l)+" is not a constructor or null");v(s,l);function e(){this.constructor=s}s.prototype=l===null?Object.create(l):(e.prototype=l.prototype,new e)}}(),__awaiter=this&&this.__awaiter||function(v,s,l,e){function n(t){return t instanceof l?t:new l(function(i){i(t)})}return new(l||(l=Promise))(function(t,i){function a(h){try{c(e.next(h))}catch(o){i(o)}}function g(h){try{c(e.throw(h))}catch(o){i(o)}}function c(h){h.done?t(h.value):n(h.value).then(a,g)}c((e=e.apply(v,s||[])).next())})},__generator=this&&this.__generator||function(v,s){var l={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},e,n,t,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(c){return function(h){return g([c,h])}}function g(c){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(l=0)),l;)try{if(e=1,n&&(t=c[0]&2?n.return:c[0]?n.throw||((t=n.return)&&t.call(n),0):n.next)&&!(t=t.call(n,c[1])).done)return t;switch(n=0,t&&(c=[c[0]&2,t.value]),c[0]){case 0:case 1:t=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,n=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(t=l.trys,!(t=t.length>0&&t[t.length-1])&&(c[0]===6||c[0]===2)){l=0;continue}if(c[0]===3&&(!t||c[1]>t[0]&&c[1]<t[3])){l.label=c[1];break}if(c[0]===6&&l.label<t[1]){l.label=t[1],t=c;break}if(t&&l.label<t[2]){l.label=t[2],l.ops.push(c);break}t[2]&&l.ops.pop(),l.trys.pop();continue}c=s.call(v,l)}catch(h){c=[6,h],n=0}finally{e=t=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}};define("cartridge/Cartridge",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Cartridge=void 0;var l=function(){function e(n){this.gameDataView=n,this.gameBytes=new Uint8Array(n.buffer)}return e.prototype.readByte=function(n){return this.gameDataView.getUint8(n)},e.prototype.readWord=function(n){return this.gameDataView.getUint16(n,!0)},e.prototype.readSignedByte=function(n){return this.gameDataView.getInt8(n)},e.prototype.writeByte=function(n,t){},e.prototype.writeWord=function(n,t){},e.prototype.isGameboyColor=function(){var n=this.gameDataView.getUint8(323);return[128,192].includes(n)},Object.defineProperty(e.prototype,"romSize",{get:function(){var n=328,t=this.gameDataView.getUint8(n),i=[32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608];return i[t]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){var n=308,t=323;return new TextDecoder().decode(this.gameBytes.subarray(n,t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){var n=327;return this.gameDataView.getUint8(n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ramSize",{get:function(){var n=329,t=this.gameDataView.getUint8(n),i=[0,-1,8192,32768,131072,65536];return i[t]},enumerable:!1,configurable:!0}),e}();s.Cartridge=l}),define("cartridge/CartridgeType",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CartridgeType=void 0;var l;(function(e){e[e.ROM=0]="ROM",e[e.MBC1=1]="MBC1",e[e.MBC1_PLUS_RAM=2]="MBC1_PLUS_RAM",e[e.MBC1_PLUS_RAM_PLUS_BATTERY=3]="MBC1_PLUS_RAM_PLUS_BATTERY",e[e.MBC2=5]="MBC2",e[e.MBC2_PLUS_BATTERY=6]="MBC2_PLUS_BATTERY",e[e.ROM_PLUS_RAM=8]="ROM_PLUS_RAM",e[e.ROM_PLUS_RAM_PLUS_BATTERY=9]="ROM_PLUS_RAM_PLUS_BATTERY",e[e.MM01=11]="MM01",e[e.MM01_PLUS_RAM=12]="MM01_PLUS_RAM",e[e.MMO1_PLUS_RAM_PLUS_BATTERY=13]="MMO1_PLUS_RAM_PLUS_BATTERY",e[e.MBC3_PLUS_TIMER_PLUS_BATTERY=15]="MBC3_PLUS_TIMER_PLUS_BATTERY",e[e.MBC3_PLUS_TIMER_PLUS_RAM_PLUS_BATTERY=16]="MBC3_PLUS_TIMER_PLUS_RAM_PLUS_BATTERY",e[e.MBC3=17]="MBC3",e[e.MBC3_PLUS_RAM=18]="MBC3_PLUS_RAM",e[e.MBC3_PLUS_RAM_PLUS_BATTERY=19]="MBC3_PLUS_RAM_PLUS_BATTERY",e[e.MBC5=25]="MBC5",e[e.MBC5_PLUS_RAM=26]="MBC5_PLUS_RAM",e[e.MBC5_PLUS_RAM_PLUS_BATTERY=27]="MBC5_PLUS_RAM_PLUS_BATTERY",e[e.MBC5_PLUS_RUMBLE=28]="MBC5_PLUS_RUMBLE",e[e.MBC5_PLUS_RUMBLE_PLUS_RAM=29]="MBC5_PLUS_RUMBLE_PLUS_RAM",e[e.MBC5_PLUS_RUMBLE_PLUS_RAM_PLUS_BATTERY=30]="MBC5_PLUS_RUMBLE_PLUS_RAM_PLUS_BATTERY",e[e.MBC6=32]="MBC6",e[e.MBC7_PLUS_SENSOR_PLUS_RUMBLE_PLUS_RAM_PLUS_BATTERY=34]="MBC7_PLUS_SENSOR_PLUS_RUMBLE_PLUS_RAM_PLUS_BATTERY",e[e.POCKET_CAMERA=252]="POCKET_CAMERA",e[e.BANDAI_TAMA5=253]="BANDAI_TAMA5",e[e.HuC3=254]="HuC3",e[e.HuC1_PLUS_RAM_PLUS_BATTERY=255]="HuC1_PLUS_RAM_PLUS_BATTERY"})(l||(s.CartridgeType=l={}))}),define("misc/SramSaver",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SramSaver=void 0;var l=function(){function e(){}return e.saveFile=function(n,t){var i=Array.from(t);localStorage.setItem("".concat(n,".sav"),JSON.stringify(i))},e.loadFile=function(n){var t=localStorage.getItem("".concat(n,".sav"));if(t!=null){var i=JSON.parse(t);return new Uint8Array(i)}return null},e}();s.SramSaver=l}),define("cartridge/ReadMethod",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ReadMethod=void 0;var l;(function(e){e[e.READ_BYTE=0]="READ_BYTE",e[e.READ_SIGNED_BYTE=1]="READ_SIGNED_BYTE",e[e.READ_WORD=2]="READ_WORD"})(l||(s.ReadMethod=l={}))}),define("cartridge/WriteMethods",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.WriteMethod=void 0;var l;(function(e){e[e.WRITE_BYTE=0]="WRITE_BYTE",e[e.WRITE_WORD=1]="WRITE_WORD"})(l||(s.WriteMethod=l={}))}),define("cartridge/MbcCartridge",["require","exports","misc/SramSaver","cartridge/Cartridge","cartridge/ReadMethod","cartridge/WriteMethods"],function(v,s,l,e,n,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.MbcCartridge=void 0;var i=function(a){__extends(g,a);function g(c){var h=a.call(this,c)||this;h.ramBuffer=new ArrayBuffer(h.ramSize),h.ramView=new DataView(h.ramBuffer),h.ramBytes=new Uint8Array(h.ramBuffer),h.sramTimeout=null,h.hasBattery=!1,h.readMethods=[function(r){return h.gameDataView.getUint8(r)},function(r){return h.gameDataView.getInt8(r)},function(r){return h.gameDataView.getUint16(r,!0)}],h.ramReadMethods=[function(r){return h.ramView.getUint8(r)},function(r){return h.ramView.getInt8(r)},function(r){return h.ramView.getUint16(r,!0)}],h.ramWriteMethods=[function(r,u){h.ramView.setUint8(r,u),h.hasBattery&&(h.sramTimeout!=null&&clearTimeout(h.sramTimeout),h.sramTimeout=setTimeout(function(){return l.SramSaver.saveFile(h.name,h.ramBytes)},1500))},function(r,u){h.ramView.setUint16(r,u,!0),h.hasBattery&&(h.sramTimeout!=null&&clearTimeout(h.sramTimeout),h.sramTimeout=setTimeout(function(){return l.SramSaver.saveFile(h.name,h.ramBytes)},1500))}],h.ramBytes.fill(255);var o=l.SramSaver.loadFile(h.name);return o?.length===h.ramSize&&(h.ramBuffer=o.buffer,h.ramView=new DataView(o.buffer),h.ramBytes=o),h}return g.prototype.readByte=function(c){return this._read(c,n.ReadMethod.READ_BYTE)},g.prototype.readSignedByte=function(c){return this._read(c,n.ReadMethod.READ_SIGNED_BYTE)},g.prototype.readWord=function(c){return this._read(c,n.ReadMethod.READ_WORD)},g.prototype._read=function(c,h){return-1},g.prototype.writeByte=function(c,h){this._write(c,h,t.WriteMethod.WRITE_BYTE)},g.prototype.writeWord=function(c,h){this._write(c,h,t.WriteMethod.WRITE_WORD)},g.prototype._write=function(c,h,o){},g}(e.Cartridge);s.MbcCartridge=i}),define("cartridge/Mbc1Cartridge",["require","exports","cartridge/CartridgeType","cartridge/MbcCartridge"],function(v,s,l,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Mbc1Cartridge=void 0;var n=function(t){__extends(i,t);function i(a){var g=t.call(this,a)||this;return g.ramEnabled=!1,g.mode=0,g.romBankNumber=1,g.ramBankNumber=0,g.type===l.CartridgeType.MBC1_PLUS_RAM_PLUS_BATTERY&&(g.hasBattery=!0),g}return i.prototype.resetRam=function(){this.ramBytes.fill(0,0,this.ramBytes.length-1)},i.prototype._read=function(a,g){return a>=0&&a<=16383?this.readFromBankZero(a,g):a>=16384&&a<=32767?this.readFromBanksOneThrough7f(a,g):this.readFromRam(a,g)},i.prototype.readFromRam=function(a,g){if(!this.ramEnabled)return 255;var c=a-40960&8191,h=this.ramReadMethods[g];if(this.mode===0)return h(c);var o=(this.ramBankNumber<<13)+c;return h(o)},i.prototype.readFromBankZero=function(a,g){var c=this.readMethods[g],h=a&16383;if(this.mode===0)return c(h);var o=(this.ramBankNumber<<19)+h&this.romSize-1;return c(o)},i.prototype.readFromBanksOneThrough7f=function(a,g){var c=this.readMethods[g],h=(this.ramBankNumber<<5)+this.romBankNumber,o=a&16383,r=(h<<14)+o&this.romSize-1;return c(r)},i.prototype._write=function(a,g,c){if(this.isRamEnableRegister(a))this.ramEnabled=g===10;else if(this.isRomBankNumberRegister(a))this.romBankNumber=g===0?1:g&31;else if(this.isRamBankNumberRegister(a))this.ramBankNumber=g&3;else if(this.isBankingModeRegister(a))this.mode=g&1;else if(this.isRamAddress(a)&&this.ramEnabled){var h=a-40960&8191,o=this.ramWriteMethods[c];if(this.mode===0)o(h,g);else{var r=(this.ramBankNumber<<13)+h;o(r,g)}}},i.prototype.isRamEnableRegister=function(a){return a>=0&&a<=8191},i.prototype.isRomBankNumberRegister=function(a){return a>=8192&&a<=16383},i.prototype.isRamBankNumberRegister=function(a){return a>=16384&&a<=24575},i.prototype.isBankingModeRegister=function(a){return a>=24576&&a<=32767},i.prototype.isRamAddress=function(a){return a>=40960&&a<=49151},i}(e.MbcCartridge);s.Mbc1Cartridge=n}),define("cartridge/Mbc2Cartridge",["require","exports","cartridge/CartridgeType","cartridge/Mbc1Cartridge"],function(v,s,l,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Mbc2Cartridge=void 0;var n=function(t){__extends(i,t);function i(a){var g=t.call(this,a)||this;return g.romBankNumber=1,g.type===l.CartridgeType.MBC2_PLUS_BATTERY&&(g.hasBattery=!0),g}return i.prototype._read=function(a,g){var c=this.readMethods[g];if(this.isRomBankZero(a))return c(a);if(this.isRomBankOneThroughF(a)){var h=a&16383,o=(this.romBankNumber<<14)+h&this.romSize-1;return c(o)}if(this.isRam1(a))return c(a-40960)&15;var r=a-40960&511;return c(r)&15},i.prototype._write=function(a,g,c){var h=this.ramWriteMethods[c];if(this.isRamEnableOrRomBankNumber(a)){var o=a>>8&1;o?this.ramEnabled=g===10:this.romBankNumber=g===0?1:g&15}else if(this.isRam1(a))h(a-40960,g);else{var r=a-40960&511;h(r,g&15)}},i.prototype.isRomBankZero=function(a){return a>=0&&a<=16383},i.prototype.isRomBankOneThroughF=function(a){return a>=16384&&a<=32767},i.prototype.isRam1=function(a){return a>=40960&&a<=41471},i.prototype.isRam2=function(a){return a>=41472&&a<=49151},i.prototype.isRamEnableOrRomBankNumber=function(a){return a>=0&&a<=16383},i}(e.Mbc1Cartridge);s.Mbc2Cartridge=n}),define("misc/BitOperations",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.resetBit=s.getBit=s.setBit=void 0;function l(t,i,a){var g=n(t,i);return a===1&&(g|=a<<i),g}s.setBit=l;function e(t,i){return t>>i&1}s.getBit=e;function n(t,i){return t&~(1<<i)}s.resetBit=n}),define("cartridge/Mbc3Cartridge",["require","exports","misc/BitOperations","cartridge/CartridgeType","cartridge/MbcCartridge"],function(v,s,l,e,n){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Mbc3Cartridge=void 0;var t;(function(a){a[a.Unlatched=0]="Unlatched",a[a.Latched=1]="Latched"})(t||(t={}));var i=function(a){__extends(g,a);function g(c){var h=a.call(this,c)||this;return h.mode=0,h.ramAndTimerEnable=!1,h.romBankNumber=1,h.ramBankNumberOrRtcRegister=0,h.sramTimeout=null,h.secondsRegister=[0,0],h.minutesRegister=[0,0],h.hoursRegister=[0,0],h.lowerDaysRegister=[0,0],h.upperDaysRegister=[0,0],h.latchClockRegister=-1,h.clockIsLatched=!1,h.type===e.CartridgeType.MBC3_PLUS_TIMER_PLUS_RAM_PLUS_BATTERY&&(h.updateClock(),setInterval(function(){h.updateClock()},1e3)),[e.CartridgeType.MBC3_PLUS_RAM_PLUS_BATTERY,e.CartridgeType.MBC3_PLUS_TIMER_PLUS_BATTERY,e.CartridgeType.MBC3_PLUS_TIMER_PLUS_RAM_PLUS_BATTERY].includes(h.type)&&(h.hasBattery=!0),h}return g.prototype.updateClock=function(){var c=new Date;this.secondsRegister[t.Unlatched]=c.getSeconds(),this.minutesRegister[t.Unlatched]=c.getMinutes(),this.hoursRegister[t.Unlatched]=c.getHours(),this.lowerDaysRegister[t.Unlatched]=this.getDays(),this.upperDaysRegister[t.Unlatched]=0},g.prototype.getDays=function(){var c=new Date;return(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate())-Date.UTC(c.getFullYear(),0,0))/24/60/60/1e3},g.prototype._read=function(c,h){var o=this.readMethods[h],r=this.ramReadMethods[h];if(this.isRomBankZero(c))return o(c);if(this.isRomBankOneThru7f(c)){var u=c&16383,f=this.romBankNumber<<14|u;return o(f)}if(!this.ramAndTimerEnable)return 255;if(this.ramBankNumberOrRtcRegister<=3){var u=c-40960&8191,R=this.ramBankNumberOrRtcRegister<<13|u;return r(R)}else return this.readFromRtcRegister()},g.prototype.copyRTCToLatchedRegisters=function(){this.secondsRegister[t.Latched]=this.secondsRegister[t.Unlatched],this.minutesRegister[t.Latched]=this.minutesRegister[t.Unlatched],this.hoursRegister[t.Latched]=this.minutesRegister[t.Unlatched],this.lowerDaysRegister[t.Latched]=this.lowerDaysRegister[t.Unlatched],this.upperDaysRegister[t.Latched]=this.upperDaysRegister[t.Unlatched]},g.prototype._write=function(c,h,o){var r=this.ramWriteMethods[o];if(this.isRamAndTimerEnableAddress(c)){var u=h&15;this.ramAndTimerEnable=u===10}else if(this.isRomBankNumber(c))this.romBankNumber=h&127,this.romBankNumber===0&&(this.romBankNumber=1);else if(this.isRamBankNumberOrRtcRegisterSelect(c))this.ramBankNumberOrRtcRegister=h;else if(this.isLatchClockAddress(c))this.latchClockRegister===0&&h===1&&(this.clockIsLatched=!this.clockIsLatched,this.clockIsLatched&&this.copyRTCToLatchedRegisters()),this.latchClockRegister=h;else if(this.isRamOrRtcRegisterAddress(c))if(this.ramBankNumberOrRtcRegister<=3){var f=c-40960&8191,R=(this.ramBankNumberOrRtcRegister<<13)+f;r(R,h)}else this.updateRtcRegister(h)},g.prototype.readFromRtcRegister=function(){var c=t.Unlatched;switch(this.ramBankNumberOrRtcRegister){case 8:return this.secondsRegister[c];case 9:return this.minutesRegister[c];case 10:return this.hoursRegister[c];case 11:return this.lowerDaysRegister[c];case 12:return this.upperDaysRegister[c];default:throw new Error("invalid value specified:0x".concat(this.ramBankNumberOrRtcRegister.toString(16)))}},g.prototype.updateRtcRegister=function(c){var h=t.Unlatched;switch(this.upperDaysRegister[h]=(0,l.setBit)(this.upperDaysRegister[h],6,1),this.ramBankNumberOrRtcRegister){case 8:this.secondsRegister[h]=c%60;break;case 9:this.minutesRegister[h]=c%60;break;case 10:this.hoursRegister[h]=c%60;break;case 11:var o=(0,l.getBit)(c,8);this.lowerDaysRegister[h]=c&255,this.upperDaysRegister[h]=(0,l.setBit)(this.upperDaysRegister[h],0,o),c>511&&(this.upperDaysRegister[h]=(0,l.setBit)(this.upperDaysRegister[h],7,1));break;case 12:this.upperDaysRegister[h]=c&255;break;default:throw new Error("invalid value specified")}this.upperDaysRegister[h]=(0,l.setBit)(this.upperDaysRegister[h],6,0)},g.prototype.isRomBankZero=function(c){return c>=0&&c<=16383},g.prototype.isRomBankOneThru7f=function(c){return c>=16384&&c<=32767},g.prototype.isRamAndTimerEnableAddress=function(c){return c>=0&&c<=8191},g.prototype.isRomBankNumber=function(c){return c>=8192&&c<=16383},g.prototype.isRamBankNumberOrRtcRegisterSelect=function(c){return c>=16384&&c<=24575},g.prototype.isLatchClockAddress=function(c){return c>=24576&&c<=32767},g.prototype.isRamOrRtcRegisterAddress=function(c){return c>=40960&&c<=49151},g}(n.MbcCartridge);s.Mbc3Cartridge=i}),define("cartridge/Mbc5Cartridge",["require","exports","cartridge/CartridgeType","cartridge/MbcCartridge"],function(v,s,l,e){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Mbc5Cartridge=void 0;var n=function(t){__extends(i,t);function i(a){var g=t.call(this,a)||this;return g.romBankNumberLower=0,g.romBankNumberHigher=0,g.ramBankNumber=0,g.ramEnabled=!1,g.type===l.CartridgeType.MBC5_PLUS_RAM_PLUS_BATTERY&&(g.hasBattery=!0),g}return i.prototype._read=function(a,g){var c=this.readMethods[g],h=this.ramReadMethods[g];if(this.isRomBankZero(a))return c(a);if(this.isRomBankZeroThrough1ff(a)){var o=a&16383,r=(this.romBankNumberHigher<<8)+this.romBankNumberLower,u=(r<<14)+o&this.romSize-1;return c(u)}if(this.isRam(a)){if(!this.ramEnabled)return 255;var o=a-40960&8191,f=(this.ramBankNumber<<13)+o;return h(f)}throw Error("invalid address specified")},i.prototype._write=function(a,g,c){var h=this.ramWriteMethods[c];if(this.isRamEnable(a)){var o=g&15;this.ramEnabled=o===10}else if(this.isRomBankNumberLowerBits(a))this.romBankNumberLower=g&255;else if(this.isRomBankNumberUpperBit(a))this.romBankNumberHigher=g&1;else if(this.isRamBankNumber(a))this.ramBankNumber=g&15;else if(this.isRam(a)&&this.ramEnabled){var r=a-40960&8191,u=(this.ramBankNumber<<13)+r;h(u,g)}},i.prototype.isRomBankZero=function(a){return a>=0&&a<=16383},i.prototype.isRomBankZeroThrough1ff=function(a){return a>=16384&&a<=32767},i.prototype.isRam=function(a){return a>=40960&&a<=49151},i.prototype.isRamEnable=function(a){return a>=0&&a<=8191},i.prototype.isRomBankNumberLowerBits=function(a){return a>=8192&&a<=12287},i.prototype.isRomBankNumberUpperBit=function(a){return a>=12288&&a<=16383},i.prototype.isRamBankNumber=function(a){return a>=16384&&a<=24575},i}(e.MbcCartridge);s.Mbc5Cartridge=n}),define("cpu/memory_registers/MemoryRegister",["require","exports","misc/BitOperations"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.MemoryRegister=void 0;var e=function(){function n(t,i,a){this.address=t,this.memory=i,this.type=a}return Object.defineProperty(n.prototype,"value",{get:function(){return this.memory.readByte(this.address)},set:function(t){this.memory.writeByte(this.address,t,this.type)},enumerable:!1,configurable:!0}),n.prototype.setBit=function(t,i){this.value=(0,l.setBit)(this.value,t,i)},n.prototype.getBit=function(t){return(0,l.getBit)(this.value,t)},n.prototype.resetBit=function(t){this.value=(0,l.resetBit)(this.value,t)},n}();s.MemoryRegister=e}),define("gpu/registers/BackgroundPaletteIndexRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BackgroundPaletteIndexRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65384,i,"BackgroundPaletteIndexRegister")||this}return Object.defineProperty(t.prototype,"paletteAddress",{get:function(){return this.value&63},set:function(i){var a=i&63,g=this.getBit(7)<<7|a;this.memory.writeByte(this.address,g)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoIncrement",{get:function(){return this.getBit(7)===1},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.BackgroundPaletteIndexRegister=e}),define("gpu/registers/ObjectPaletteIndexRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ObjectPaletteIndexRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65386,i)||this}return Object.defineProperty(t.prototype,"paletteAddress",{get:function(){return this.value&63},set:function(i){var a=i&63,g=this.getBit(7)<<7|a;this.memory.writeByte(this.address,g)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoIncrement",{get:function(){return this.value>>7&1},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ObjectPaletteIndexRegister=e}),define("cpu/memory_registers/JoypadRegister",["require","exports","misc/BitOperations"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.joypadRegister=s.JoypadRegister=void 0;var e=function(){function n(){this.value=255,this.isPressingDown=!1,this.isPressingUp=!1,this.isPressingLeft=!1,this.isPressingRight=!1,this.isPressingA=!1,this.isPressingB=!1,this.isPressingStart=!1,this.isPressingSelect=!1}return Object.defineProperty(n.prototype,"isCheckingDirections",{get:function(){return this.getBit(4)===0},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isCheckingButtons",{get:function(){return this.getBit(5)===0},enumerable:!1,configurable:!0}),n.prototype.getInput=function(){return this.isCheckingDirections&&(this.setBit(0,this.isPressingRight?0:1),this.setBit(1,this.isPressingLeft?0:1),this.setBit(2,this.isPressingUp?0:1),this.setBit(3,this.isPressingDown?0:1)),this.isCheckingButtons&&(this.setBit(0,this.isPressingA?0:1),this.setBit(1,this.isPressingB?0:1),this.setBit(2,this.isPressingSelect?0:1),this.setBit(3,this.isPressingStart?0:1)),this.setBit(4,this.isCheckingButtons?0:1),this.setBit(5,this.isCheckingDirections?0:1),this.value},n.prototype.setBit=function(t,i){this.value=(0,l.setBit)(this.value,t,i)},n.prototype.getBit=function(t){return(0,l.getBit)(this.value,t)},n}();s.JoypadRegister=e,s.joypadRegister=new e}),define("cpu/Memory",["require","exports","cartridge/Cartridge","cartridge/CartridgeType","cartridge/Mbc1Cartridge","cartridge/Mbc2Cartridge","cartridge/Mbc3Cartridge","cartridge/Mbc5Cartridge","gpu/registers/BackgroundPaletteIndexRegister","gpu/registers/ObjectPaletteIndexRegister","misc/BitOperations","cpu/memory_registers/JoypadRegister"],function(v,s,l,e,n,t,i,a,g,c,h,o){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Memory=void 0;var r=65280,u=65350,f=65284,R=327,b=65365,m;(function(d){d[d.GeneralPurpose=0]="GeneralPurpose",d[d.Hblank=1]="Hblank"})(m||(m={}));var T=s.Memory=function(){function d(){this.memoryBuffer=new ArrayBuffer(65536),this.memoryView=new DataView(this.memoryBuffer),this.memoryBytes=new Uint8Array(this.memoryBuffer),this.backgroundPaletteIndexRegister=new g.BackgroundPaletteIndexRegister(this),this.objectPaletteIndexRegister=new c.ObjectPaletteIndexRegister(this),this.initialHdmaSourceAddress=0,this.initialHdmaDestinationAddress=0,this.currentHdmaSourceAddress=-1,this.currentHdmaDestinationAddress=-1,this.currentTransferLength=-1,this.vramBank1Buffer=new ArrayBuffer(8192),this.vramView=new DataView(this.vramBank1Buffer),this.vramBytes=new Uint8Array(this.vramBank1Buffer),this.backgroundPaletteRam=new ArrayBuffer(64),this.backgroundPaletteView=new DataView(this.backgroundPaletteRam),this.backgroundPaletteBytes=new Uint8Array(this.backgroundPaletteRam),this.objectPaletteRam=new ArrayBuffer(64),this.objectPaletteView=new DataView(this.objectPaletteRam),this.objectPaletteBytes=new Uint8Array(this.objectPaletteRam),this.wramBankBuffers=[],this.wramBankViews=[],this.wramBankBytes=[];for(var p=1;p<8;p++){var y=new ArrayBuffer(4096);this.wramBankBuffers[p]=y,this.wramBankViews[p]=new DataView(y),this.wramBankBytes[p]=new Uint8Array(y)}}return d.prototype.loadCartridge=function(p){var y=p.getUint8(R);switch(y){case e.CartridgeType.ROM:this.cartridge=new l.Cartridge(p);break;case e.CartridgeType.MBC1:case e.CartridgeType.MBC1_PLUS_RAM:case e.CartridgeType.MBC1_PLUS_RAM_PLUS_BATTERY:this.cartridge=new n.Mbc1Cartridge(p);break;case e.CartridgeType.MBC2:case e.CartridgeType.MBC2_PLUS_BATTERY:this.cartridge=new t.Mbc2Cartridge(p);break;case e.CartridgeType.MBC3:case e.CartridgeType.MBC3_PLUS_RAM:case e.CartridgeType.MBC3_PLUS_RAM_PLUS_BATTERY:case e.CartridgeType.MBC3_PLUS_TIMER_PLUS_BATTERY:case e.CartridgeType.MBC3_PLUS_TIMER_PLUS_RAM_PLUS_BATTERY:this.cartridge=new i.Mbc3Cartridge(p);break;case e.CartridgeType.MBC5:case e.CartridgeType.MBC5_PLUS_RAM:case e.CartridgeType.MBC5_PLUS_RAM_PLUS_BATTERY:this.cartridge=new a.Mbc5Cartridge(p);break;default:throw new Error("Cartridge type not supported: ".concat(y))}return this.isGBC=this.cartridge.isGameboyColor(),this.isGBC},Object.defineProperty(d.prototype,"wramBank",{get:function(){var p=this.readByte(65392);return p===0?1:p&7},set:function(p){var y=p&7?p:1;this.writeByte(65392,y&7)},enumerable:!1,configurable:!0}),d.prototype.reset=function(){this.memoryBytes.fill(0,0,this.memoryBytes.length-1),this.vramBytes.fill(0,0,this.vramBytes.length-1),this.backgroundPaletteBytes.fill(0,0,this.backgroundPaletteBytes.length-1),this.objectPaletteBytes.fill(0,0,this.objectPaletteBytes.length-1)},d.prototype.readByte=function(p,y){var B=y??this.vramBank;if(this.cartridge==null)throw new Error("game ROM not loaded into memory!");return this.isAccessingCartridge(p)?this.cartridge.readByte(p):p===d.BgpdRegisterAddress?this.backgroundPaletteView.getUint8(this.backgroundPaletteIndexRegister.paletteAddress):p===d.ObpdRegisterAddress?this.objectPaletteView.getUint8(this.objectPaletteIndexRegister.paletteAddress):p===r?o.joypadRegister.getInput():this.isVram(p)&&B===1?this.vramView.getUint8(p-32768):this.isWramBanks(p)?this.wramBankViews[this.wramBank].getUint8(p-53248):this.memoryView.getUint8(p)},Object.defineProperty(d.prototype,"vramBank",{get:function(){return this.memoryView.getUint8(65359)&1},enumerable:!1,configurable:!0}),d.prototype.readSignedByte=function(p){if(this.cartridge==null)throw new Error("game ROM not loaded into memory!");return this.isAccessingCartridge(p)?this.cartridge.readSignedByte(p):this.isVram(p)&&this.vramBank===1?this.vramView.getInt8(p-32768):this.isWramBanks(p)?this.wramBankViews[this.wramBank].getInt8(p-53248):this.memoryView.getInt8(p)},d.prototype.readWord=function(p){if(this.cartridge==null)throw new Error("game ROM not loaded into memory!");return this.isAccessingCartridge(p)?this.cartridge.readWord(p):this.isVram(p)&&this.vramBank===1?this.vramView.getUint16(p-32768,!0):this.isWramBanks(p)?this.wramBankViews[this.wramBank].getUint16(p-53248,!0):this.memoryView.getUint16(p,!0)},d.prototype.writeByte=function(p,y,B,M){var C;if(M===void 0&&(M=!1),this.isAccessingCartridge(p)){(C=this.cartridge)===null||C===void 0||C.writeByte(p,y);return}if(p===r){o.joypadRegister.value=y;return}if(p===f&&!M){this.memoryView.setUint8(p,0);return}if(p===d.BgpdRegisterAddress){this.backgroundPaletteView.setUint8(this.backgroundPaletteIndexRegister.paletteAddress,y),this.backgroundPaletteIndexRegister.autoIncrement&&this.backgroundPaletteIndexRegister.paletteAddress++;return}if(p===d.ObpdRegisterAddress){this.objectPaletteView.setUint8(this.objectPaletteIndexRegister.paletteAddress,y),this.objectPaletteIndexRegister.autoIncrement&&this.objectPaletteIndexRegister.paletteAddress++;return}if(this.isVram(p)&&this.vramBank===1){this.vramView.setUint8(p-32768,y);return}if(this.isWramBanks(p)){this.wramBankViews[this.wramBank].setUint8(p-53248,y);return}this.memoryView.setUint8(p,y),p===u&&this.doDmaTransfer(y),p===b&&this.doHdmaTransfer(y)},d.prototype.writeWord=function(p,y){var B;if(this.isAccessingCartridge(p)){(B=this.cartridge)===null||B===void 0||B.writeWord(p,y);return}if(this.isVram(p)&&this.isGBC&&this.vramBank===1){this.vramView.setUint16(p-32768,y,!0);return}if(this.isWramBanks(p)){this.wramBankViews[this.wramBank].setUint16(p-53248,y,!0);return}this.memoryView.setUint16(p,y,!0)},d.prototype.isAccessingCartridge=function(p){return p<=32767||p>=40960&&p<=49151},d.prototype.isVram=function(p){return p>=32768&&p<=40959},d.prototype.isWramBanks=function(p){return p>=53248&&p<=57343},d.prototype.doDmaTransfer=function(p){for(var y=p<<8,B=0;B<160;B++)this.writeByte(65024+B,this.readByte(y+B))},d.prototype.doHdmaTransfer=function(p){var y=((p&127)+1)*16,B=(0,h.getBit)(p,7),M=this.hdmaDestinationAddress,C=this.hdmaSourceAddress;B===m.GeneralPurpose?this.doGeneralPurposeHdma(C,M,y):(this.currentHdmaDestinationAddress=-1,this.currentHdmaSourceAddress=-1,this.initialHdmaSourceAddress=C,this.initialHdmaDestinationAddress=M,this.currentTransferLength=y)},Object.defineProperty(d.prototype,"hdmaDestinationAddress",{get:function(){var p=this.readByte(65363)&31,y=this.readByte(65364)&240;return(p<<8)+y},set:function(p){var y=p>>8&31,B=p&240;this.writeByte(65363,y),this.writeByte(65364,B)},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"hdmaSourceAddress",{get:function(){var p=this.readByte(65361),y=this.readByte(65362)&240;return(p<<8)+y},set:function(p){var y=p>>8,B=p&240;this.writeByte(65361,y),this.writeByte(65362,B)},enumerable:!1,configurable:!0}),d.prototype.doGeneralPurposeHdma=function(p,y,B){for(var M=y|32768,C=0;C<B;C++)this.writeByte(M+C,this.readByte(p+C));this.writeByte(65365,255),this.hdmaDestinationAddress+=B,this.hdmaSourceAddress+=B},d.prototype.doHblankHdmaTransfer=function(){if(this.currentTransferLength!==0){this.currentHdmaDestinationAddress===-1&&(this.currentHdmaDestinationAddress=this.initialHdmaDestinationAddress),this.currentHdmaSourceAddress===-1&&(this.currentHdmaSourceAddress=this.initialHdmaSourceAddress);for(var p=this.currentHdmaDestinationAddress|32768,y=0;y<16;y++)this.writeByte(p+y,this.readByte(this.currentHdmaSourceAddress+y));this.hdmaDestinationAddress+=16,this.hdmaSourceAddress+=16,this.currentTransferLength-=16,this.currentHdmaDestinationAddress=this.hdmaDestinationAddress,this.currentHdmaSourceAddress=this.hdmaSourceAddress}},d.BgpdRegisterAddress=65385,d.ObpdRegisterAddress=65387,d}()}),define("apu/AudioBufferPlayer",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.AudioBufferPlayer=void 0;var l=function(){function e(n){this.readPointer=new Uint32Array(new SharedArrayBuffer(4)),this.writePointer=new Uint32Array(new SharedArrayBuffer(4)),this.samples=new Float32Array(1024),this.sampleIndex=0,this.audioContext=n,this.audioBuffer=new SharedArrayBuffer(this.audioContext.sampleRate/20*Float32Array.BYTES_PER_ELEMENT),this.audioData=new Float32Array(this.audioBuffer),this.addAudioWorklet()}return e.prototype.addAudioWorklet=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return[4,this.audioContext.audioWorklet.addModule("AudioProcessor.js")];case 1:return n.sent(),this.audioPlayerNode=new AudioWorkletNode(this.audioContext,"audio-processor",{processorOptions:{audioData:this.audioData,readPointer:this.readPointer,writePointer:this.writePointer}}),this.audioPlayerNode.connect(this.audioContext.destination),[2]}})})},e.prototype.writeSample=function(n){this.samples[this.sampleIndex]=n,this.sampleIndex++,this.sampleIndex===this.samples.length&&(this.push(this.samples),this.sampleIndex=0)},e.prototype.push=function(n){var t=Atomics.load(this.readPointer,0),i=Atomics.load(this.writePointer,0),a=this._availableWrite(t,i);if(a===0)return 0;var g=Math.min(a,n.length),c=Math.min(this.audioData.length-i,g),h=g-c;this.copy(n,0,this.audioData,i,c),this.copy(n,c,this.audioData,0,h);var o=(i+g)%this.audioData.length;return Atomics.store(this.writePointer,0,o),g},e.prototype.availableWrite=function(){var n=Atomics.load(this.readPointer,0),t=Atomics.load(this.writePointer,0);return this._availableWrite(n,t)},e.prototype._availableWrite=function(n,t){var i=n-t-1;return t>=n&&(i+=this.audioData.length),i},e.prototype.copy=function(n,t,i,a,g){for(var c=0;c<g;c++)i[a+c]=n[t+c]},e}();s.AudioBufferPlayer=l}),define("apu/registers/ChannelFrequencyHighRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelFrequencyHighRegister=void 0;var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"frequencyHighBits",{get:function(){return this.value&7},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"soundLengthEnable",{get:function(){return this.getBit(6)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"restartTrigger",{get:function(){return this.getBit(7)},set:function(i){this.setBit(7,i&1)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelFrequencyHighRegister=e}),define("apu/registers/ChannelLengthTimerAndDutyRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelLengthTimerAndDutyRegister=void 0;var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"waveDuty",{get:function(){return this.value>>6&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialLengthTimer",{get:function(){return this.value&63},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelLengthTimerAndDutyRegister=e}),define("apu/registers/ChannelSweepRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelSweepRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65296,i)||this}return Object.defineProperty(t.prototype,"sweepShift",{get:function(){return this.value&7},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sweepDirection",{get:function(){return this.getBit(3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"sweepPace",{get:function(){return this.value>>4&7},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelSweepRegister=e}),define("apu/registers/ChannelVolumeAndEnvelopeRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelVolumeAndEnvelopeRegister=void 0;var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"sweepPace",{get:function(){return this.value&7},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"envelopeDirection",{get:function(){return this.getBit(3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"initialVolume",{get:function(){return this.value>>4},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelVolumeAndEnvelopeRegister=e}),define("apu/registers/MasterVolumeAndVinPanningRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.MasterVolumeAndVinPanningRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65316,i)||this}return Object.defineProperty(t.prototype,"rightVolume",{get:function(){return(this.value&7)+1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixVinIntoRightOutput",{get:function(){return this.getBit(3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftVolume",{get:function(){return(this.value>>4&7)+1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixVinIntoLeftOutput",{get:function(){return this.getBit(7)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.MasterVolumeAndVinPanningRegister=e}),define("apu/registers/SoundOnRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SoundOnRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65318,i)||this}return Object.defineProperty(t.prototype,"isSoundOn",{get:function(){return this.getBit(7)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChannel1On",{get:function(){return this.getBit(0)},set:function(i){this.setBit(0,i&1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChannel2On",{get:function(){return this.getBit(1)},set:function(i){this.setBit(1,i&1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChannel3On",{get:function(){return this.getBit(2)},set:function(i){this.setBit(2,i&1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isChannel4On",{get:function(){return this.getBit(3)},set:function(i){this.setBit(3,i&1)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.SoundOnRegister=e}),define("apu/registers/SoundPanningRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.SoundPanningRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65317,i)||this}return Object.defineProperty(t.prototype,"mixChannel1Right",{get:function(){return this.getBit(0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel2Right",{get:function(){return this.getBit(1)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel3Right",{get:function(){return this.getBit(2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel4Right",{get:function(){return this.getBit(3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel1Left",{get:function(){return this.getBit(4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel2Left",{get:function(){return this.getBit(5)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel3Left",{get:function(){return this.getBit(6)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mixChannel4Left",{get:function(){return this.getBit(7)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.SoundPanningRegister=e}),define("apu/channels/Channel2",["require","exports","cpu/memory_registers/MemoryRegister","apu/registers/ChannelFrequencyHighRegister","apu/registers/ChannelLengthTimerAndDutyRegister","apu/registers/ChannelVolumeAndEnvelopeRegister","apu/registers/MasterVolumeAndVinPanningRegister","apu/registers/SoundOnRegister","apu/registers/SoundPanningRegister"],function(v,s,l,e,n,t,i,a,g){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Channel2=void 0;var c=function(){function h(o){this.dutyTable=[[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,1,1],[0,0,0,0,1,1,1,1],[1,1,1,1,1,1,0,0]],this.volume=0,this.periodTimer=0,this.lengthTimer=0,this.frequencyTimer=0,this.waveDutyPosition=0,this.memory=o,this.channelLengthTimerAndDutyRegister=new n.ChannelLengthTimerAndDutyRegister(65302,this.memory),this.channelVolumeAndEnvelopeRegister=new t.ChannelVolumeAndEnvelopeRegister(65303,this.memory),this.channelFrequencyLowRegister=new l.MemoryRegister(65304,this.memory),this.channelFrequencyHighRegister=new e.ChannelFrequencyHighRegister(65305,this.memory),this.soundOnRegister=new a.SoundOnRegister(this.memory),this.soundPanningRegister=new g.SoundPanningRegister(this.memory),this.masterVolumeAndVinPanningRegister=new i.MasterVolumeAndVinPanningRegister(this.memory)}return h.prototype.tick=function(o){this.frequencyTimer-=o,this.channelFrequencyHighRegister.restartTrigger&&(this.restartSound(),this.channelFrequencyHighRegister.restartTrigger=0),this.frequencyTimer<=0&&(this.frequencyTimer=this.getFrequencyTimer(),this.waveDutyPosition=(this.waveDutyPosition+1)%8)},h.prototype.restartSound=function(){this.soundOnRegister.isChannel2On=1,this.periodTimer=this.channelVolumeAndEnvelopeRegister.sweepPace,this.volume=this.channelVolumeAndEnvelopeRegister.initialVolume,this.frequencyTimer=this.getFrequencyTimer(),this.lengthTimer=64-this.channelLengthTimerAndDutyRegister.initialLengthTimer},h.prototype.getSample=function(){var o=this.dutyTable[this.channelLengthTimerAndDutyRegister.waveDuty][this.waveDutyPosition],r=this.volume!==0&&this.soundOnRegister.isChannel2On?o*this.volume:0;return r/7.5-1},h.prototype.clockLength=function(){this.channelFrequencyHighRegister.soundLengthEnable&&(this.lengthTimer--,this.lengthTimer===0&&(this.soundOnRegister.isChannel2On=0))},h.prototype.clockVolume=function(){var o=this.channelVolumeAndEnvelopeRegister,r=o.sweepPace,u=o.envelopeDirection;r!==0&&(this.periodTimer!==0&&this.periodTimer--,this.periodTimer===0&&(this.periodTimer=r,u===0&&this.volume>0?this.volume--:u===1&&this.volume<15&&this.volume++))},h.prototype.getFrequencyTimer=function(){return(2048-this.getFrequency())*4},h.prototype.getFrequency=function(){return this.channelFrequencyLowRegister.value|this.channelFrequencyHighRegister.frequencyHighBits<<8},h}();s.Channel2=c}),define("apu/channels/Channel1",["require","exports","cpu/memory_registers/MemoryRegister","apu/registers/ChannelFrequencyHighRegister","apu/registers/ChannelLengthTimerAndDutyRegister","apu/registers/ChannelSweepRegister","apu/registers/ChannelVolumeAndEnvelopeRegister","apu/channels/Channel2"],function(v,s,l,e,n,t,i,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Channel1=void 0;var g=function(c){__extends(h,c);function h(o){var r=c.call(this,o)||this;return r.sweepEnabled=!1,r.sweepTimer=0,r.shadowFrequency=0,r.channelSweepRegister=new t.ChannelSweepRegister(o),r.channelLengthTimerAndDutyRegister=new n.ChannelLengthTimerAndDutyRegister(65297,r.memory),r.channelVolumeAndEnvelopeRegister=new i.ChannelVolumeAndEnvelopeRegister(65298,r.memory),r.channelFrequencyLowRegister=new l.MemoryRegister(65299,r.memory),r.channelFrequencyHighRegister=new e.ChannelFrequencyHighRegister(65300,r.memory),r}return h.prototype.restartSound=function(){this.soundOnRegister.isChannel2On=1,this.periodTimer=this.channelVolumeAndEnvelopeRegister.sweepPace,this.volume=this.channelVolumeAndEnvelopeRegister.initialVolume,this.frequencyTimer=this.getFrequencyTimer(),this.lengthTimer=64-this.channelLengthTimerAndDutyRegister.initialLengthTimer,this.sweepTimer=this.channelSweepRegister.sweepPace!==0?this.channelSweepRegister.sweepPace:8,(this.channelSweepRegister.sweepPace>0||this.channelSweepRegister.sweepShift>0)&&(this.sweepEnabled=!0),this.shadowFrequency=this.getFrequency()},h.prototype.calculateFrequency=function(){var o=this.shadowFrequency>>this.channelSweepRegister.sweepShift;return this.channelSweepRegister.sweepDirection===1?o=this.shadowFrequency+o:o=this.shadowFrequency-o,o>2047&&(this.soundOnRegister.isChannel1On=0),o},h.prototype.clockSweep=function(){if(this.sweepTimer>0&&this.sweepTimer--,this.sweepTimer===0&&(this.sweepTimer=this.channelSweepRegister.sweepPace!==0?this.channelSweepRegister.sweepPace:8,this.sweepEnabled&&this.sweepTimer>0)){var o=this.calculateFrequency();o<2047&&this.sweepTimer>0&&(this.frequencyTimer=o,this.shadowFrequency=o)}},h}(a.Channel2);s.Channel1=g}),define("apu/registers/ChannelDACEnableRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelDACEnableRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65306,i)||this}return Object.defineProperty(t.prototype,"dacEnabled",{get:function(){return this.getBit(7)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelDACEnableRegister=e}),define("apu/registers/ChannelOutputLevelRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelOutputLevelRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65308,i)||this}return Object.defineProperty(t.prototype,"outputLevelSelection",{get:function(){return this.value>>5&3},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelOutputLevelRegister=e}),define("apu/channels/Channel3",["require","exports","cpu/memory_registers/MemoryRegister","apu/registers/ChannelDACEnableRegister","apu/registers/ChannelFrequencyHighRegister","apu/registers/ChannelOutputLevelRegister","apu/registers/SoundOnRegister"],function(v,s,l,e,n,t,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Channel3=void 0;var a=function(){function g(c){this.sampleStartAddress=65328,this.frequencyTimer=0,this.samplePosition=0,this.lengthTimer=0,this.volumeShifts=[4,0,1,2],this.memory=c,this.channelDACEnableRegister=new e.ChannelDACEnableRegister(this.memory),this.channelLengthTimerRegister=new l.MemoryRegister(65307,this.memory),this.channelOutputLevelRegister=new t.ChannelOutputLevelRegister(this.memory),this.channelFrequencyLowRegister=new l.MemoryRegister(65309,this.memory),this.channelFrequencyHighRegister=new n.ChannelFrequencyHighRegister(65310,this.memory),this.soundOnRegister=new i.SoundOnRegister(this.memory)}return g.prototype.tick=function(c){this.frequencyTimer-=c,this.channelFrequencyHighRegister.restartTrigger&&(this.restartSound(),this.channelFrequencyHighRegister.restartTrigger=0),this.frequencyTimer<=0&&(this.frequencyTimer=this.getFrequencyTimer(),this.samplePosition=(this.samplePosition+1)%32)},g.prototype.clockLength=function(){this.channelFrequencyHighRegister.soundLengthEnable&&(this.lengthTimer--,this.lengthTimer===0&&(this.soundOnRegister.isChannel3On=0))},g.prototype.getSample=function(){var c=Math.floor(this.samplePosition/2),h=this.samplePosition%2===0,o=this.memory.readByte(this.sampleStartAddress+c),r=h?o>>4:o&15,u=r>>this.volumeShifts[this.channelOutputLevelRegister.outputLevelSelection];return this.soundOnRegister.isChannel3On&&this.channelDACEnableRegister.dacEnabled?u/7.5-1:0},g.prototype.restartSound=function(){this.soundOnRegister.isChannel3On=1,this.frequencyTimer=this.getFrequencyTimer(),this.samplePosition=0,this.lengthTimer=256-this.channelLengthTimerRegister.value},g.prototype.getFrequencyTimer=function(){return(2048-this.getFrequency())*2},g.prototype.getFrequency=function(){return this.channelFrequencyLowRegister.value|this.channelFrequencyHighRegister.frequencyHighBits<<8},g}();s.Channel3=a}),define("apu/registers/Channel4ControlRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Channel4ControlRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65315,i)||this}return Object.defineProperty(t.prototype,"soundLengthEnable",{get:function(){return this.getBit(6)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"restartTrigger",{get:function(){return this.getBit(7)},set:function(i){this.setBit(7,i)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.Channel4ControlRegister=e}),define("apu/registers/Channel4LengthTimerRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Channel4LengthTimerRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65312,i)||this}return Object.defineProperty(t.prototype,"lengthTimer",{get:function(){return this.value&63},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.Channel4LengthTimerRegister=e}),define("apu/registers/ChannelFrequencyAndRandomnessRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ChannelFrequencyAndRandomnessRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65314,i)||this}return Object.defineProperty(t.prototype,"divisorCode",{get:function(){return this.value&7},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lfsrWidth",{get:function(){return this.getBit(3)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clockShift",{get:function(){return this.value>>4},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ChannelFrequencyAndRandomnessRegister=e}),define("apu/channels/Channel4",["require","exports","misc/BitOperations","apu/registers/Channel4ControlRegister","apu/registers/Channel4LengthTimerRegister","apu/registers/ChannelFrequencyAndRandomnessRegister","apu/registers/ChannelVolumeAndEnvelopeRegister","apu/registers/SoundOnRegister"],function(v,s,l,e,n,t,i,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Channel4=void 0;var g=function(){function c(h){this.divisors=[8,16,32,48,64,80,96,112],this.frequencyTimer=0,this.lengthTimer=0,this.volume=0,this.linearFeedbackShift=1,this.periodTimer=0,this.memory=h,this.channel4LengthTimerRegister=new n.Channel4LengthTimerRegister(this.memory),this.channelVolumeAndEnvelopeRegister=new i.ChannelVolumeAndEnvelopeRegister(65313,this.memory),this.channelFrequencyAndRandomnessRegister=new t.ChannelFrequencyAndRandomnessRegister(this.memory),this.channel4ControlRegister=new e.Channel4ControlRegister(this.memory),this.soundOnRegister=new a.SoundOnRegister(this.memory)}return c.prototype.tick=function(h){if(this.channel4ControlRegister.restartTrigger&&(this.restartSound(),this.channel4ControlRegister.restartTrigger=0),this.frequencyTimer-=h,this.frequencyTimer<=0){this.frequencyTimer=this.getFrequencyTimer();var o=(0,l.getBit)(this.linearFeedbackShift,0)^(0,l.getBit)(this.linearFeedbackShift,1);this.linearFeedbackShift=this.linearFeedbackShift>>1|o<<14,this.channelFrequencyAndRandomnessRegister.lfsrWidth===1&&(this.linearFeedbackShift=(0,l.setBit)(this.linearFeedbackShift,6,o))}},c.prototype.clockLength=function(){this.channel4ControlRegister.soundLengthEnable&&(this.lengthTimer--,this.lengthTimer===0&&(this.soundOnRegister.isChannel4On=0))},c.prototype.clockVolume=function(){var h=this.channelVolumeAndEnvelopeRegister,o=h.sweepPace,r=h.envelopeDirection;o!==0&&(this.periodTimer!==0&&this.periodTimer--,this.periodTimer===0&&(this.periodTimer=o,r===0&&this.volume>0?this.volume--:r===1&&this.volume<15&&this.volume++))},c.prototype.getSample=function(){var h=(~this.linearFeedbackShift&1)*this.volume;return this.soundOnRegister.isChannel4On?h/7.5-1:0},c.prototype.restartSound=function(){this.soundOnRegister.isChannel4On=1,this.frequencyTimer=this.getFrequencyTimer(),this.linearFeedbackShift=32767,this.volume=this.channelVolumeAndEnvelopeRegister.initialVolume,this.periodTimer=this.channelVolumeAndEnvelopeRegister.sweepPace,this.lengthTimer=64-this.channel4LengthTimerRegister.lengthTimer},c.prototype.getFrequencyTimer=function(){var h=this.divisors[this.channelFrequencyAndRandomnessRegister.divisorCode];return h<<this.channelFrequencyAndRandomnessRegister.clockShift},c}();s.Channel4=g}),define("apu/APU",["require","exports","apu/AudioBufferPlayer","apu/channels/Channel1","apu/channels/Channel2","apu/channels/Channel3","apu/channels/Channel4"],function(v,s,l,e,n,t,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.APU=void 0;var a=function(){function g(c){this.frameSequencerCyclesPerStep=8192,this.frameSequencerStep=0,this.audioContext=new AudioContext({sampleRate:44100}),this.cpuUperatingHertz=4194304,this.cyclesPerSample=this.cpuUperatingHertz/44100,this.sampleCycles=0,this.frameSequencerCycles=0,this.memory=c,this.channel1=new e.Channel1(c),this.channel2=new n.Channel2(c),this.channel3=new t.Channel3(c),this.channel4=new i.Channel4(c),this.audioBufferPlayer=new l.AudioBufferPlayer(this.audioContext)}return g.prototype.tick=function(c){this.sampleCycles+=c,this.frameSequencerCycles+=c,this.channel1.tick(c),this.channel2.tick(c),this.channel3.tick(c),this.channel4.tick(c),this.frameSequencerCycles>=this.frameSequencerCyclesPerStep&&(this.advanceFrameSequencer(),this.frameSequencerCycles-=this.frameSequencerCyclesPerStep),this.sampleCycles>=this.cyclesPerSample&&(this.sampleAudio(),this.sampleCycles-=this.cyclesPerSample)},g.prototype.advanceFrameSequencer=function(){switch(this.frameSequencerStep){case 0:this.clockLength();break;case 2:this.clockLength(),this.clockSweep();break;case 4:this.clockLength();break;case 6:this.clockLength(),this.clockSweep();break;case 7:this.clockVolume();break}this.frameSequencerStep=(this.frameSequencerStep+1)%8},g.prototype.sampleAudio=function(){var c=(this.channel1.getSample()+this.channel2.getSample()+this.channel3.getSample()+this.channel4.getSample())/4;this.audioBufferPlayer.writeSample(c)},g.prototype.clockLength=function(){this.channel1.clockLength(),this.channel2.clockLength(),this.channel3.clockLength(),this.channel4.clockLength()},g.prototype.clockSweep=function(){this.channel1.clockSweep()},g.prototype.clockVolume=function(){this.channel1.clockVolume(),this.channel2.clockVolume(),this.channel4.clockVolume()},g}();s.APU=a}),define("cpu/memory_registers/InterruptRequestRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.InterruptRequestRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65295,i,"InterruptRequestRegister")||this}return t.prototype.vBlankInterruptRequest=function(){return this.getBit(0)},t.prototype.lcdStatInterruptRequest=function(){return this.getBit(1)},t.prototype.timerInterruptRequest=function(){return this.getBit(2)},t.prototype.serialInterruptRequest=function(){return this.getBit(3)},t.prototype.joypadInterruptRequest=function(){return this.getBit(4)},t.prototype.clearVBlankRequest=function(){this.resetBit(0)},t.prototype.clearLcdStatRequest=function(){this.resetBit(1)},t.prototype.clearTimerRequest=function(){this.resetBit(2)},t.prototype.clearSerialRequest=function(){this.resetBit(3)},t.prototype.clearJoypadRequest=function(){this.resetBit(4)},t.prototype.triggerVBlankRequest=function(){this.setBit(0,1)},t.prototype.triggerLcdStatRequest=function(){this.setBit(1,1)},t.prototype.triggerTimerRequest=function(){this.setBit(2,1)},t.prototype.triggerSerialRequest=function(){this.setBit(3,1)},t.prototype.triggerJoypadRequest=function(){this.setBit(4,1)},t}(l.MemoryRegister);s.InterruptRequestRegister=e}),define("gpu/registers/BackgroundPaletteRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.BackgroundPaletteRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65351,i,"BackgroundPaletteRegister")||this}return Object.defineProperty(t.prototype,"color0",{get:function(){return this.value&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color1",{get:function(){return this.value>>2&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color2",{get:function(){return this.value>>4&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color3",{get:function(){return this.value>>6&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colors",{get:function(){return[this.color0,this.color1,this.color2,this.color3]},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.BackgroundPaletteRegister=e}),define("gpu/registers/LCDControlRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.LCDControlRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65344,i,"LCDControlRegister")||this}return t.prototype.isBackgroundOn=function(){return this.getBit(0)===1},t.prototype.doesBgHavePriority=function(){return this.getBit(0)===1},t.prototype.isObjOn=function(){return this.getBit(1)===1},t.prototype.objSize=function(){return this.getBit(2)===0?8:16},t.prototype.bgTileMapArea=function(){return this.getBit(3)===0?38912:39936},t.prototype.bgAndWindowTileDataArea=function(){return this.getBit(4)===0?34816:32768},t.prototype.isWindowOn=function(){return this.getBit(5)===1},t.prototype.windowTileMapArea=function(){return this.getBit(6)===0?38912:39936},t.prototype.isLCDControllerOn=function(){return this.getBit(7)===1},t}(l.MemoryRegister);s.LCDControlRegister=e}),define("gpu/registers/ObjectPaletteRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.ObjectPaletteRegister=void 0;var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"color0",{get:function(){return this.value&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color1",{get:function(){return this.value>>2&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color2",{get:function(){return this.value>>4&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color3",{get:function(){return this.value>>6&3},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"colors",{get:function(){return[this.color0,this.color1,this.color2,this.color3]},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.ObjectPaletteRegister=e}),define("gpu/registers/lcd_status/LCDMode",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.LCDMode=void 0;var l;(function(e){e[e.HBlank=0]="HBlank",e[e.VBlank=1]="VBlank",e[e.SearchingOAM=2]="SearchingOAM",e[e.TransferringToLCD=3]="TransferringToLCD"})(l||(s.LCDMode=l={}))}),define("gpu/registers/lcd_status/LCDStatusRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.LCDStatusRegister=void 0;var e=function(n){__extends(t,n);function t(i){var a=n.call(this,65345,i,"LCDStatusRegister")||this;return a.value=131,a}return Object.defineProperty(t.prototype,"mode",{get:function(){return this.value&3},set:function(i){var a=i&1,g=i>>1&1;this.setBit(0,a),this.setBit(1,g)},enumerable:!1,configurable:!0}),t.prototype.isLineYCompareMatching=function(){return this.getBit(2)},t.prototype.isHBlankInterruptSelected=function(){return this.getBit(3)},t.prototype.isVBlankInterruptSelected=function(){return this.getBit(4)},t.prototype.isOamInterruptSelected=function(){return this.getBit(5)},t.prototype.isLineYMatchingInerruptSelected=function(){return this.getBit(6)},Object.defineProperty(t.prototype,"lineYCompareMatching",{set:function(i){this.setBit(2,i)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.LCDStatusRegister=e}),define("gpu/registers/GPURegisters",["require","exports","gpu/registers/BackgroundPaletteRegister","cpu/memory_registers/MemoryRegister","gpu/registers/LCDControlRegister","gpu/registers/ObjectPaletteRegister","gpu/registers/lcd_status/LCDStatusRegister","gpu/registers/BackgroundPaletteIndexRegister","gpu/registers/ObjectPaletteIndexRegister"],function(v,s,l,e,n,t,i,a,g){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.GPURegisters=void 0;var c=function(){function h(o){this.memory=o,this.lcdStatusRegister=new i.LCDStatusRegister(o),this.lineYRegister=new e.MemoryRegister(65348,o,"lineYRegister"),this.lcdControlRegister=new n.LCDControlRegister(o),this.scrollYRegister=new e.MemoryRegister(65346,o,"scrollYRegister"),this.scrollXRegister=new e.MemoryRegister(65347,o,"scrollXRegister"),this.lineYCompareRegister=new e.MemoryRegister(65349,o,"lineYCompareRegister"),this.windowYRegister=new e.MemoryRegister(65354,o,"windowYRegister"),this.windowXRegister=new e.MemoryRegister(65355,o,"windowXRegister"),this.backgroundPaletteRegister=new l.BackgroundPaletteRegister(o),this.objectPaletteRegister0=new t.ObjectPaletteRegister(65352,o,"objetPaletteRegister0"),this.objectPaletteRegister1=new t.ObjectPaletteRegister(65353,o,"objectPaletteRegister1"),this.backgroundPaletteIndexRegister=new a.BackgroundPaletteIndexRegister(o),this.objectPaletteIndexRegister=new g.ObjectPaletteIndexRegister(o),this.lcdControlRegister.value=131,this.lineYRegister.value=145}return h}();s.GPURegisters=c}),define("gpu/registers/OAMTable",["require","exports","misc/BitOperations"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.OAMEntry=s.OAMTable=void 0;var e=65024,n=65183,t=function(){function a(g){this.entries=[],this.memory=g;for(var c=e;c<n;c+=4)this.entries.push(new i(c,g))}return a}();s.OAMTable=t;var i=function(){function a(g,c){this.address=g,this.memory=c}return Object.defineProperty(a.prototype,"yPosition",{get:function(){return this.memory.readByte(this.address)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"xPosition",{get:function(){return this.memory.readByte(this.address+1)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tileIndex",{get:function(){return this.memory.readByte(this.address+2)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"attributeFlags",{get:function(){return this.memory.readByte(this.address+3)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"paletteNumber",{get:function(){return(0,l.getBit)(this.attributeFlags,4)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isXFlipped",{get:function(){return(0,l.getBit)(this.attributeFlags,5)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"isYFlipped",{get:function(){return(0,l.getBit)(this.attributeFlags,6)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bgAndWindowOverObj",{get:function(){return(0,l.getBit)(this.attributeFlags,7)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"cgbPaletteNumber",{get:function(){return this.attributeFlags&7},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"tileVramBankNumber",{get:function(){return(0,l.getBit)(this.attributeFlags,3)},enumerable:!1,configurable:!0}),a}();s.OAMEntry=i}),define("gpu/GPU",["require","exports","cpu/Memory","cpu/memory_registers/InterruptRequestRegister","misc/BitOperations","gpu/registers/GPURegisters","gpu/registers/OAMTable","gpu/registers/lcd_status/LCDMode"],function(v,s,l,e,n,t,i,a){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.GPU=void 0;var g=204,c=80,h=172,o=g+c+h,r=4560,u=144,f=[{red:255,green:255,blue:255},{red:192,green:192,blue:192},{red:96,green:96,blue:96},{red:0,green:0,blue:0}],R=s.GPU=function(){function b(m){this.windowPixelsDrawn=[],this.backgroundPixelsDrawn=[],this.backgroundPixelPriorities=[],this.cycles=0,this.internalWindowLineCounter=0,this.isGBC=!1,this.colors=f,this.screen=new ImageData(b.screenWidth,b.screenHeight),this.memory=m,this.registers=new t.GPURegisters(m),this.oamTable=new i.OAMTable(m),this.registers.lineYRegister.value=145}return b.prototype.tick=function(m){var T=new e.InterruptRequestRegister(this.memory);if(!this.registers.lcdControlRegister.isLCDControllerOn()){this.registers.lcdStatusRegister.mode=a.LCDMode.HBlank,this.registers.lineYRegister.value=145,this.cycles=0;return}switch(this.cycles+=m,this.registers.lcdStatusRegister.mode){case a.LCDMode.HBlank:this.cycles>=g&&(this.isGBC&&this.isHDMATransferActive()&&this.memory.doHblankHdmaTransfer(),this.drawLine(),this.registers.lineYRegister.value++,this.registers.lineYRegister.value===b.screenHeight?(this.registers.lcdStatusRegister.mode=a.LCDMode.VBlank,T.triggerVBlankRequest()):this.registers.lcdStatusRegister.mode=a.LCDMode.SearchingOAM,this.cycles-=g);break;case a.LCDMode.VBlank:this.cycles>=o&&(this.registers.lcdStatusRegister.lineYCompareMatching=this.registers.lineYCompareRegister.value===this.registers.lineYRegister.value?1:0,this.registers.lcdStatusRegister.isLineYCompareMatching()&&this.registers.lcdStatusRegister.isLineYMatchingInerruptSelected()&&T.triggerLcdStatRequest(),this.registers.lineYRegister.value++,this.registers.lineYRegister.value===b.offscreenHeight&&(this.registers.lcdStatusRegister.mode=a.LCDMode.SearchingOAM,this.registers.lineYRegister.value=0,this.internalWindowLineCounter=0),this.cycles-=o);break;case a.LCDMode.SearchingOAM:this.cycles>=c&&(this.registers.lcdStatusRegister.mode=a.LCDMode.TransferringToLCD,this.cycles-=c);break;case a.LCDMode.TransferringToLCD:if(this.cycles>=h){var d=this.registers.lcdStatusRegister;(d.isHBlankInterruptSelected()||d.isVBlankInterruptSelected()||d.isOamInterruptSelected())&&T.triggerLcdStatRequest(),this.registers.lcdStatusRegister.lineYCompareMatching=this.registers.lineYCompareRegister.value===this.registers.lineYRegister.value?1:0,this.registers.lcdStatusRegister.isLineYCompareMatching()&&this.registers.lcdStatusRegister.isLineYMatchingInerruptSelected()&&T.triggerLcdStatRequest(),this.registers.lcdStatusRegister.mode=a.LCDMode.HBlank,this.cycles-=h}break}},b.prototype.isHDMATransferActive=function(){var m=this.memory.readByte(65365);return(0,n.getBit)(m,7)===1&&m!==255},b.prototype.drawLine=function(){var m=this.registers.lcdControlRegister;this.backgroundPixelsDrawn=[],this.windowPixelsDrawn=[],this.isGBC?(this.backgroundPixelPriorities=[],this.drawBackgroundLineGBC(),m.isWindowOn()&&this.drawWindowLineGBC(),m.isObjOn()&&this.drawSpriteLineGBC()):(this.drawBackgroundLine(),m.isWindowOn()&&this.drawWindowLine(),m.isObjOn()&&this.drawSpriteLine())},b.prototype.drawBackgroundLineGBC=function(){for(var m,T=this,d=(m=this.registers,m.lineYRegister),p=m.lcdControlRegister,y=m.scrollXRegister,B=m.scrollYRegister,M=m.backgroundPaletteIndexRegister,C=p.bgAndWindowTileDataArea(),D=C===34816?128:0,x=function(Q){return C===34816?T.memory.readSignedByte(Q):T.memory.readByte(Q)},A=0;A<b.screenWidth;A++){var k=y.value+A&255,P=B.value+d.value&255,E=Math.floor(P/8)*32+Math.floor(k/8),O=k%8,I=P%8,Y=x(p.bgTileMapArea()+E)+D,w=this.memory.readByte(p.bgTileMapArea()+E,1),F=w&7,_=(0,n.getBit)(w,3),W=(0,n.getBit)(w,5),z=(0,n.getBit)(w,6),H=(0,n.getBit)(w,7),q=4,U=2,L=F*q*U,j=this.getPaletteColors(L,l.Memory.BgpdRegisterAddress,M);z&&(I=7-I);var S=I*2,V=C+Y*16+S,N=this.memory.readByte(V,_),J=this.memory.readByte(V+1,_),Z=W?O:7-O,K=(0,n.getBit)(N,Z),X=(0,n.getBit)(J,Z)<<1,$=K+X,G=j[$];this.backgroundPixelsDrawn.push($!==0),this.backgroundPixelPriorities.push(H),this.drawPixel(A,d.value,G.red,G.green,G.blue)}},b.prototype.drawWindowLineGBC=function(){var m,T=this,d=(m=this.registers,m.lineYRegister),p=m.lcdControlRegister,y=m.windowXRegister,B=m.windowYRegister,M=m.backgroundPaletteIndexRegister;if(!(d.value<B.value||y.value>b.screenWidth+7)){for(var C=p.bgAndWindowTileDataArea(),D=function(te){return C===34816?T.memory.readSignedByte(te):T.memory.readByte(te)},x=0,A=y.value-7,k=C===34816?128:0,P=p.windowTileMapArea(),E=this.internalWindowLineCounter;x<b.screenWidth;){if(x<A){this.windowPixelsDrawn.push(!1),x++;continue}var O=x-A,I=Math.floor(O/8)+Math.floor(E/8)*32,Y=D(P+I)+k,w=this.memory.readByte(P+I,1),F=w&7,_=(0,n.getBit)(w,3),W=(0,n.getBit)(w,5),z=(0,n.getBit)(w,6),H=(0,n.getBit)(w,7),q=E%8;z&&(q=7-q);for(var U=q*2,L=4,j=2,S=F*L*j,V=this.getPaletteColors(S,l.Memory.BgpdRegisterAddress,M),N=C+Y*16+U,J=this.memory.readByte(N,_),Z=this.memory.readByte(N+1,_),K=7;K>=0;K--){var X=W?7-K:K,$=(0,n.getBit)(J,X),G=(0,n.getBit)(Z,X)<<1,Q=$+G,ee=V[Q];this.windowPixelsDrawn.push(Q!==0),this.backgroundPixelPriorities[x]=H,this.drawPixel(x,d.value,ee.red,ee.green,ee.blue),x++}}this.internalWindowLineCounter++}},b.prototype.getPaletteColors=function(m,T,d){for(var p=[],y=0;p.length<4;){d.paletteAddress=m+y;var B=this.memory.readByte(T);y++,d.paletteAddress=m+y;var M=this.memory.readByte(T),C=B&31,D=(B>>5)+((M&3)<<3),x=M>>2&31;C=C<<3|C>>2,D=D<<3|D>>2,x=x<<3|x>>2,p.push({red:C,green:D,blue:x}),y++}return p},b.prototype.drawSpriteLineGBC=function(){for(var m,T=(m=this.registers,m.lineYRegister),d=m.lcdControlRegister,p=m.objectPaletteIndexRegister,y=32768,B=10,M=0,C=[],D=0,x=this.oamTable.entries;D<x.length;D++){var A=x[D];if(M===B)break;var k=A.yPosition-16,P=A.xPosition-8,E=T.value-k;if(A.isYFlipped&&(E=d.objSize()-1-E),!(E<0||E>=d.objSize())){for(var O=d.objSize()===16?(0,n.resetBit)(A.tileIndex,0):A.tileIndex,I=O*16,Y=E*2,w=I+Y+y,F=A.cgbPaletteNumber,_=4,W=2,z=F*_*W,H=this.getPaletteColors(z,l.Memory.ObpdRegisterAddress,p),q=this.memory.readByte(w,A.tileVramBankNumber),U=this.memory.readByte(w+1,A.tileVramBankNumber),L=0;L<8;L++){var j=A.isXFlipped?L:7-L,S=(0,n.getBit)(q,j),V=(0,n.getBit)(U,j)<<1,N=S+V;if(!(N===0||P+L<0)){var J=H[N],Z=this.backgroundPixelsDrawn[P+L],K=this.windowPixelsDrawn[P+L],X=!this.spriteHasPriority(A,this.backgroundPixelPriorities[P+L])&&(K||Z);!X&&!C[P+L]&&(C[P+L]=!0,this.drawPixel(P+L,T.value,J.red,J.green,J.blue))}}M++}}},b.prototype.drawSpriteLine=function(){for(var m,T=(m=this.registers,m.lineYRegister),d=m.lcdControlRegister,p=32768,y=this.oamTable.entries.filter(function(S){var V=S.yPosition-16;if(S.xPosition===0||S.yPosition===0||S.xPosition>b.screenWidth+8||S.yPosition>b.screenHeight+16)return!1;var N=T.value-V;return S.isYFlipped&&(N=d.objSize()-1-N),N>=0&&N<d.objSize()}).slice(0,10).reverse().sort(function(S,V){return V.xPosition-S.xPosition}),B=0,M=y;B<M.length;B++){var C=M[B],D=C.yPosition-16,x=C.xPosition-8,A=T.value-D;C.isYFlipped&&(A=d.objSize()-1-A);for(var k=d.objSize()===16?(0,n.resetBit)(C.tileIndex,0):C.tileIndex,P=k*16,E=A*2,O=P+E+p,I=this.memory.readByte(O),Y=this.memory.readByte(O+1),w=C.paletteNumber===0?this.registers.objectPaletteRegister0.colors:this.registers.objectPaletteRegister1.colors,F=0;F<8;F++){var _=C.isXFlipped?F:7-F,W=(0,n.getBit)(I,_),z=(0,n.getBit)(Y,_)<<1,H=W+z;if(!(H===0||x+F<0)){var q=w[H],U=this.colors[q],L=this.backgroundPixelsDrawn[x+F],j=this.windowPixelsDrawn[x+F];C.bgAndWindowOverObj&&(j||L)||this.drawPixel(x+F,T.value,U.red,U.green,U.blue)}}}},b.prototype.drawBackgroundLine=function(){for(var m,T=this,d=(m=this.registers,m.lineYRegister),p=m.lcdControlRegister,y=m.scrollXRegister,B=m.scrollYRegister,M=p.bgAndWindowTileDataArea(),C=M===34816?128:0,D=function(S){return M===34816?T.memory.readSignedByte(S):T.memory.readByte(S)},x=this.registers.backgroundPaletteRegister.colors,A=0;A<b.screenWidth;A++)if(p.isBackgroundOn()){var E=y.value+A&255,O=B.value+d.value&255,I=Math.floor(O/8)*32+Math.floor(E/8),Y=O%8,w=E%8,F=Y*2,_=D(p.bgTileMapArea()+I)+C,W=M+_*16+F,z=this.memory.readByte(W),H=this.memory.readByte(W+1),q=7-w,U=(0,n.getBit)(z,q),L=(0,n.getBit)(H,q)<<1,j=U+L,k=x[j],P=this.colors[k];this.backgroundPixelsDrawn.push(j!==0),this.drawPixel(A,d.value,P.red,P.green,P.blue)}else{var k=x[0],P=this.colors[k];this.drawPixel(A,d.value,P.red,P.green,P.blue)}},b.prototype.drawWindowLine=function(){var m,T=this,d=(m=this.registers,m.lineYRegister),p=m.lcdControlRegister,y=m.windowXRegister,B=m.windowYRegister;if(!(d.value<B.value||y.value>b.screenWidth+7)){for(var M=p.bgAndWindowTileDataArea(),C=function(V){return M===34816?T.memory.readSignedByte(V):T.memory.readByte(V)},D=this.registers.backgroundPaletteRegister.colors,x=0,A=y.value-7,k=M===34816?128:0,P=p.windowTileMapArea(),E=this.internalWindowLineCounter;x<b.screenWidth;){if(x<A){this.windowPixelsDrawn.push(!1),x++;continue}for(var O=x-A,I=Math.floor(O/8)+Math.floor(E/8)*32,Y=E%8,w=Y*2,F=C(P+I)+k,_=M+F*16+w,W=this.memory.readByte(_),z=this.memory.readByte(_+1),H=7;H>=0;H--){var q=(0,n.getBit)(W,H),U=(0,n.getBit)(z,H)<<1,L=q+U,j=D[L],S=this.colors[j];this.windowPixelsDrawn.push(L!==0),this.drawPixel(x,d.value,S.red,S.green,S.blue),x++}}this.internalWindowLineCounter++}},b.prototype.spriteHasPriority=function(m,T){var d=m.bgAndWindowOverObj,p=this.registers.lcdControlRegister;return!p.doesBgHavePriority()||!d&&!T},b.prototype.drawPixel=function(m,T,d,p,y,B){B===void 0&&(B=255);var M=m*4+T*this.screen.width*4;this.screen.data[M]=d,this.screen.data[M+1]=p,this.screen.data[M+2]=y,this.screen.data[M+3]=B},b.screenWidth=160,b.screenHeight=144,b.offscreenHeight=154,b.CyclesPerFrame=o*u+r,b}()}),define("cpu/memory_registers/InterruptEnableRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.InterruptEnableRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65535,i,"InterruptEnableRegister")||this}return t.prototype.isVBlankInterruptEnabled=function(){return this.getBit(0)},t.prototype.isLCDStatInterruptEnabled=function(){return this.getBit(1)},t.prototype.isTimerInterruptEnabled=function(){return this.getBit(2)},t.prototype.isSerialInterruptEnabled=function(){return this.getBit(3)},t.prototype.isJoypadInterruptEnabled=function(){return this.getBit(4)},t}(l.MemoryRegister);s.InterruptEnableRegister=e}),define("cpu/CPURegister",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CPURegister=void 0;var l=function(){function e(n,t,i,a,g){this.name=n,this.registerId=i,this.dataView=a,this.is16Bit=g,this.value=t}return Object.defineProperty(e.prototype,"value",{get:function(){return this.is16Bit?this.dataView.getUint16(this.registerId,!0):this.dataView.getUint8(this.registerId)},set:function(n){this.is16Bit?this.dataView.setUint16(this.registerId,n,!0):this.dataView.setUint8(this.registerId,n)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hexValue",{get:function(){return"0x".concat(this.value.toString(16))},enumerable:!1,configurable:!0}),e.prototype.setBit=function(n,t){var i=this.resetBit(n);t===1&&(i|=t<<n),this.value=i},e.prototype.resetBit=function(n){return this.value&~(1<<n)},e}();s.CPURegister=l}),define("cpu/CPUFlagRegister",["require","exports","cpu/CPURegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.FlagsRegister=void 0;var e=7,n=6,t=5,i=4,a=function(g){__extends(c,g);function c(){return g!==null&&g.apply(this,arguments)||this}return Object.defineProperty(c.prototype,"zero",{get:function(){return(this.value>>e&1)===1},set:function(h){h?this.value|=1<<e:this.value&=~(1<<e)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"subtract",{get:function(){return(this.value>>n&1)===1},set:function(h){h?this.value|=1<<n:this.value&=~(1<<n)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"halfCarry",{get:function(){return(this.value>>t&1)===1},set:function(h){h?this.value|=1<<t:this.value&=~(1<<t)},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"carry",{get:function(){return(this.value>>i&1)===1},set:function(h){h?this.value|=1<<i:this.value&=~(1<<i)},enumerable:!1,configurable:!0}),c}(l.CPURegister);s.FlagsRegister=a}),define("cpu/FlagsRegisterPair",["require","exports","cpu/CPURegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.FlagsRegisterPair=void 0;var e=function(n){__extends(t,n);function t(){return n!==null&&n.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"value",{get:function(){return this.dataView.getUint16(this.registerId,!0)},set:function(i){var a=65520;this.dataView.setUint16(this.registerId,i&a,!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hexValue",{get:function(){return"0x".concat(this.value.toString(16))},enumerable:!1,configurable:!0}),t}(l.CPURegister);s.FlagsRegisterPair=e}),define("cpu/memory_registers/TimerControlRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.TimerControlRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65287,i)||this}return t.prototype.isTimerEnabled=function(){return this.getBit(2)},t.prototype.getClockFrequency=function(){var i=this.value&3,a=0;switch(i){case 0:a=1024;break;case 1:a=16;break;case 2:a=64;break;case 3:a=256;break}return a},t}(l.MemoryRegister);s.TimerControlRegister=e}),define("cpu/memory_registers/DividerRegister",["require","exports","cpu/memory_registers/MemoryRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DividerRegister=void 0;var e=function(n){__extends(t,n);function t(i){return n.call(this,65284,i)||this}return Object.defineProperty(t.prototype,"overrideValue",{set:function(i){this.memory.writeByte(this.address,i,"DividerRegister",!0)},enumerable:!1,configurable:!0}),t}(l.MemoryRegister);s.DividerRegister=e}),define("cpu/CPURegisters",["require","exports","cpu/memory_registers/InterruptEnableRegister","cpu/memory_registers/InterruptRequestRegister","cpu/CPURegister","cpu/CPUFlagRegister","cpu/FlagsRegisterPair","cpu/memory_registers/MemoryRegister","cpu/memory_registers/TimerControlRegister","cpu/memory_registers/DividerRegister"],function(v,s,l,e,n,t,i,a,g,c){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CPURegisters=void 0;var h=function(){function o(r,u){this.cpu=u,this.registerDataView=new DataView(new ArrayBuffer(12)),this.A=new n.CPURegister("A",0,1,this.registerDataView,!1),this.B=new n.CPURegister("B",0,3,this.registerDataView,!1),this.C=new n.CPURegister("C",0,2,this.registerDataView,!1),this.D=new n.CPURegister("D",0,5,this.registerDataView,!1),this.E=new n.CPURegister("E",0,4,this.registerDataView,!1),this.F=new t.FlagsRegister("F",0,0,this.registerDataView,!1),this.H=new n.CPURegister("H",0,7,this.registerDataView,!1),this.L=new n.CPURegister("L",0,6,this.registerDataView,!1),this.AF=new i.FlagsRegisterPair("AF",4528,0,this.registerDataView,!0),this.BC=new n.CPURegister("BC",19,2,this.registerDataView,!0),this.DE=new n.CPURegister("DE",216,4,this.registerDataView,!0),this.HL=new n.CPURegister("HL",333,6,this.registerDataView,!0),this.SP=new n.CPURegister("SP",65534,8,this.registerDataView,!0),this.PC=new n.CPURegister("PC",256,10,this.registerDataView,!0),this.memory=r,this.interruptEnableRegister=new l.InterruptEnableRegister(r),this.interruptRequestRegister=new e.InterruptRequestRegister(r),this.dividerRegister=new c.DividerRegister(r),this.timerCounterRegister=new a.MemoryRegister(65285,r),this.timerModuloRegister=new a.MemoryRegister(65286,r),this.timerControlRegister=new g.TimerControlRegister(r)}return o.prototype.initialize=function(){this.AF.value=4480,this.BC.value=0,this.DE.value=65366,this.HL.value=13,this.SP.value=65534,this.PC.value=256},o.prototype.add=function(r,u){r.value=this._add(r.value,u.value)},o.prototype._add=function(r,u){var f=r+u&255;return this.F.subtract=!1,this.F.zero=f===0,this.F.halfCarry=(f&15)<(r&15),this.F.carry=f<r,f},o.prototype._subtract=function(r,u){var f=r-u&255;return this.F.subtract=!0,this.F.zero=f===0,this.F.halfCarry=(f&15)>(r&15),this.F.carry=f>r,f},o.prototype.addImmediate=function(r){var u=this.memory.readByte(this.PC.value);this.PC.value++,r.value=this._add(r.value,u)},o.prototype.addImmediateSigned=function(r){if(!r.is16Bit)throw new Error("invalid register selected: ".concat(r.name,". Must be a 16 bit register"));var u=this.memory.readSignedByte(this.PC.value);this.PC.value++;var f=15-(this.SP.value&15),R=255-(this.SP.value&255);this.F.carry=(u&255)>R,this.F.halfCarry=(u&15)>f,this.F.zero=!1,this.F.subtract=!1,this.SP.value+=u},o.prototype.addFromRegisterAddr=function(r,u){var f=this.memory.readByte(u.value);r.value=this._add(r.value,f)},o.prototype._addWithCarry=function(r,u){var f=this.F.carry?1:0,R=r+u+f&255;return this.F.carry=r+u+f>255,this.F.subtract=!1,this.F.halfCarry=(r&15)+(u&15)+f>15,this.F.zero=R===0,R},o.prototype.addWithCarry=function(r){this.A.value=this._addWithCarry(this.A.value,r.value)},o.prototype.addWithCarryImmediate=function(){this.A.value=this._addWithCarry(this.A.value,this.memory.readByte(this.PC.value)),this.PC.value++},o.prototype.loadHLStackPointer=function(){var r=this.memory.readSignedByte(this.PC.value);this.PC.value++;var u=15-(this.SP.value&15),f=255-(this.SP.value&255);this.F.halfCarry=(r&15)>u,this.F.carry=(r&255)>f,this.F.zero=!1,this.F.subtract=!1,this.HL.value=this.SP.value+r},o.prototype.addWithCarryFromMemory=function(r){var u=this.memory.readByte(r.value);this.A.value=this._addWithCarry(this.A.value,u)},o.prototype.complementCarryFlag=function(){this.F.subtract=!1,this.F.halfCarry=!1,this.F.carry=!this.F.carry},o.prototype.setCarryFlag=function(){this.F.subtract=!1,this.F.halfCarry=!1,this.F.carry=!0},o.prototype.readByte=function(r){r.value=this.memory.readByte(this.PC.value),this.PC.value++},o.prototype.loadFromBase=function(r){this.cpu.cycle(4);var u=this.memory.readByte(this.PC.value);this.PC.value++,r.value=this.memory.readByte(65280+u),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.loadFrom16bitAddr=function(r){this.cpu.cycle(4),this.cpu.cycle(4);var u=this.memory.readWord(this.PC.value);this.PC.value+=2,r.value=this.memory.readByte(u),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.loadByte=function(r,u){if(!u.is16Bit)throw new Error("Register is not 16 bit: ".concat(u.name));r.value=this.memory.readByte(u.value)},o.prototype.loadByte8Bit=function(r,u){if(u.is16Bit)throw new Error("Register is not 8 bit: ".concat(u.name));r.value=this.memory.readByte(65280+u.value)},o.prototype.loadByteAndIncrementSource=function(r,u){r.value=this.memory.readByte(u.value),u.value++},o.prototype.loadByteAndDecrementSource=function(r,u){r.value=this.memory.readByte(u.value),u.value--},o.prototype.loadWord=function(r){if(r.is16Bit)r.value=this.memory.readWord(this.PC.value),this.PC.value+=2;else throw new Error("invalid register selected: ".concat(r.name,". must be a 16 bit register."))},o.prototype.jump=function(){this.PC.value=this.memory.readWord(this.PC.value)},o.prototype.jumpToRegisterAddr=function(){this.PC.value=this.HL.value},o.prototype.jumpIfNotZero=function(){this.F.zero?this.PC.value+=2:this.PC.value=this.memory.readWord(this.PC.value)},o.prototype.jumpIfZero=function(){this.F.zero?this.PC.value=this.memory.readWord(this.PC.value):this.PC.value+=2},o.prototype.jumpIfNotCarry=function(){this.F.carry?this.PC.value+=2:this.PC.value=this.memory.readWord(this.PC.value)},o.prototype.jumpIfCarry=function(){this.F.carry?this.PC.value=this.memory.readWord(this.PC.value):this.PC.value+=2},o.prototype.relativeJump=function(){var r=this.memory.readSignedByte(this.PC.value);this.PC.value++,this.PC.value+=r},o.prototype.relativeJumpIfZero=function(){if(this.F.zero){var r=this.memory.readSignedByte(this.PC.value);this.PC.value++,this.PC.value+=r}else this.PC.value++},o.prototype.relativeJumpIfNotZero=function(){if(this.F.zero)this.PC.value++;else{var r=this.memory.readSignedByte(this.PC.value);this.PC.value++,this.PC.value+=r}},o.prototype.relativeJumpIfCarry=function(){if(this.F.carry){var r=this.memory.readSignedByte(this.PC.value);this.PC.value++,this.PC.value+=r}else this.PC.value++},o.prototype.relativeJumpIfNotCarry=function(){if(this.F.carry)this.PC.value++;else{var r=this.memory.readSignedByte(this.PC.value);this.PC.value++,this.PC.value+=r}},o.prototype.writeToMemory8Bit=function(r){this.cpu.cycle(4);var u=this.memory.readByte(this.PC.value);this.PC.value++,this.memory.writeByte(65280+u,r.value,"writeToMemory8Bit"),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.writeToMemory16bit=function(r){this.cpu.cycle(4),this.cpu.cycle(4);var u=this.memory.readWord(this.PC.value);this.PC.value+=2,this.memory.writeByte(u,r.value,"writeToMemory16bit"),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.writeStackPointerToMemory=function(){var r=this.memory.readWord(this.PC.value);this.PC.value+=2,this.memory.writeWord(r,this.SP.value)},o.prototype.writeToMemoryRegisterAddr=function(r,u){if(r.is16Bit)this.memory.writeByte(r.value,u.value,"writeToMemoryRegisterAddr");else throw new Error("invalid register selected: ".concat(r.name,"; need a 16 bit register."))},o.prototype.writeToMemoryRegisterAddr8bit=function(r,u){if(!r.is16Bit)this.memory.writeByte(65280+r.value,u.value,"writeToMemoryRegisterAddr8Bit");else throw new Error("invalid register selected: ".concat(r.name," need an 8 bit register."))},o.prototype.writeByteIntoRegisterAddress=function(r){if(r.is16Bit)this.cpu.cycle(4),this.memory.writeByte(r.value,this.memory.readByte(this.PC.value),"writeByteIntoRegisterAddr"),this.PC.value++,this.cpu.cycle(4),this.cpu.cycle(4);else throw new Error("invalid register selected: ".concat(r.name,"; need a 16 bit register."))},o.prototype.subtract=function(r){this.A.value=this._subtract(this.A.value,r.value)},o.prototype.subtractImmediate=function(){this.A.value=this._subtract(this.A.value,this.memory.readByte(this.PC.value)),this.PC.value++},o.prototype._subtractWithCarry=function(r,u){var f=this.F.carry?1:0,R=r-u-f&255;return this.F.subtract=!0,this.F.carry=r-u-f<0,this.F.halfCarry=(r&15)-(u&15)-f<0,this.F.zero=R===0,R},o.prototype.subtractWithCarry=function(r){this.A.value=this._subtractWithCarry(this.A.value,r.value)},o.prototype.subtractWithCarryFromMemory=function(r){var u=this.memory.readByte(r.value);this.A.value=this._subtractWithCarry(this.A.value,u)},o.prototype.subtractWithCarryImmediate=function(){var r=this.memory.readByte(this.PC.value);this.PC.value++,this.A.value=this._subtractWithCarry(this.A.value,r)},o.prototype.compare=function(r){this._subtract(this.A.value,r.value)},o.prototype.compareImmediate=function(){this._subtract(this.A.value,this.memory.readByte(this.PC.value)),this.PC.value++},o.prototype.compareFromRegisterAddr=function(r){var u=this.memory.readByte(r.value);this._subtract(this.A.value,u)},o.prototype.subtractFromMemory=function(r){var u=this.memory.readByte(r.value);this.A.value=this._subtract(this.A.value,u)},o.prototype.load=function(r,u){r.value=u.value},o.prototype._or=function(r,u){var f=(r|u)&255;return this.F.carry=!1,this.F.zero=f===0,this.F.halfCarry=!1,this.F.subtract=!1,f},o.prototype.or=function(r){this.A.value=this._or(this.A.value,r.value)},o.prototype.orFromMemory=function(r){this.A.value=this._or(this.A.value,this.memory.readByte(r.value))},o.prototype.orImmediate=function(){this.A.value=this._or(this.A.value,this.memory.readByte(this.PC.value)),this.PC.value++},o.prototype._and=function(r,u){var f=r&u&255;return this.F.carry=!1,this.F.halfCarry=!0,this.F.subtract=!1,this.F.zero=f===0,f},o.prototype.and=function(r){this.A.value=this._and(this.A.value,r.value)},o.prototype.andFromMemory=function(r){this.A.value=this._and(this.A.value,this.memory.readByte(r.value))},o.prototype.andImmediate=function(){this.A.value=this._and(this.A.value,this.memory.readByte(this.PC.value)),this.PC.value++},o.prototype._xor=function(r,u){var f=(r^u)&255;return this.F.carry=!1,this.F.halfCarry=!1,this.F.subtract=!1,this.F.zero=f===0,f},o.prototype.xor=function(r){this.A.value=this._xor(this.A.value,r.value)},o.prototype.xorImmediate=function(){this.A.value=this._xor(this.A.value,this.memory.readByte(this.PC.value)),this.PC.value++},o.prototype.xorFromMemory=function(r){this.A.value=this._xor(this.A.value,this.memory.readByte(r.value))},o.prototype.increment=function(r){var u=r.value+1&255;this.F.subtract=!1,this.F.zero=u===0,this.F.halfCarry=(u&15)<(r.value&15),r.value=u},o.prototype.decrement=function(r){var u=r.value-1&255;this.F.subtract=!0,this.F.zero=u===0,this.F.halfCarry=(u&15)>(r.value&15),r.value=u},o.prototype.add16Bit=function(r,u){if(!r.is16Bit||!u.is16Bit)throw new Error("Invalid registers: ".concat(r.name," and ").concat(u.name));var f=r.value+u.value&65535;this.F.subtract=!1,this.F.halfCarry=(f&4095)<(r.value&4095),this.F.carry=f<r.value,r.value=f},o.prototype.rotateLeft=function(){var r=this.A.value>>7;this.F.carry=r===1,this.F.halfCarry=!1,this.F.zero=!1,this.F.subtract=!1,this.A.value=(this.A.value<<1)+r},o.prototype.rotateLeftCarry=function(){var r=this.F.carry?1:0,u=this.A.value>>7,f=(this.A.value<<1)+r&255;this.F.carry=u===1,this.F.halfCarry=!1,this.F.subtract=!1,this.F.zero=!1,this.A.value=f},o.prototype.rotateRegisterLeft=function(r){this.cpu.cycle(4);var u=r.value>>7&1;r.value=(r.value<<1)+u,this.F.zero=r.value===0,this.F.carry=u===1,this.F.subtract=!1,this.F.halfCarry=!1,this.cpu.cycle(4)},o.prototype.rotateRegisterLeftCarry=function(r){this.cpu.cycle(4);var u=r.value>>7,f=this.F.carry?1:0,R=(r.value<<1)+f&255;this.F.carry=u===1,this.F.halfCarry=!1,this.F.subtract=!1,this.F.zero=R===0,r.value=R,this.cpu.cycle(4)},o.prototype.rotateAtRegisterAddrLeftCarry=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r>>7,f=(r<<1)+(this.F.carry?1:0)&255;this.F.carry=u===1,this.F.halfCarry=!1,this.F.subtract=!1,this.F.zero=f===0,this.memory.writeByte(this.HL.value,f),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.rotateRegisterRight=function(r){this.cpu.cycle(4);var u=r.value&1;r.value=(r.value>>1)+(u<<7),this.F.zero=r.value===0,this.F.carry=u===1,this.F.subtract=!1,this.F.halfCarry=!1,this.cpu.cycle(4)},o.prototype.rotateRegisterRightCarry=function(r){this.cpu.cycle(4);var u=r.value&1,f=this.F.carry?1:0;r.value=(r.value>>1&255)+(f<<7),this.F.carry=u===1,this.F.zero=r.value===0,this.F.halfCarry=!1,this.F.subtract=!1,this.cpu.cycle(4)},o.prototype.rotateAtRegisterAddrRightCarry=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r&1,f=(r>>1)+((this.F.carry?1:0)<<7);this.F.carry=u===1,this.F.zero=f===0,this.F.halfCarry=!1,this.F.subtract=!1,this.memory.writeByte(this.HL.value,f),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.rotateValueAtRegisterAddrLeft=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r>>7&1,f=(r<<1)+u;this.F.zero=f===0,this.F.carry=u===1,this.F.subtract=!1,this.F.halfCarry=!1,this.memory.writeByte(this.HL.value,f),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.rotateValueAtRegisterAddrRight=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r&1,f=(r>>1)+(u<<7);this.F.zero=f===0,this.F.carry=u===1,this.F.subtract=!1,this.F.halfCarry=!1,this.memory.writeByte(this.HL.value,f),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.rotateRight=function(){var r=this.A.value&1;this.F.carry=r===1,this.F.halfCarry=!1,this.F.zero=!1,this.F.subtract=!1,this.A.value=(this.A.value>>1)+(r<<7)},o.prototype.rotateRightCarry=function(){var r=this.A.value&1,u=this.F.carry?1:0;this.F.carry=r===1,this.F.zero=!1,this.F.halfCarry=!1,this.F.subtract=!1,this.A.value=(this.A.value>>1)+(u<<7)},o.prototype.writeToMemoryRegisterAddrAndIncrementTarget=function(r,u){this.memory.writeByte(r.value,u.value,"writeToMemoryRegisterAddrAndIncrementTarget"),r.value++},o.prototype.writeToMemoryRegisterAddrAndDecrementTarget=function(r,u){this.memory.writeByte(r.value,u.value,"writeToMemoryRegisterAddrAndDecrementTarget"),r.value--},o.prototype.decimalAdjustAccumulator=function(){var r=this,u=r.A,f=r.F,R=f.subtract?-6:6,b=f.subtract?-96:96,m=!f.subtract&&(u.value&15)>9,T=!f.subtract&&u.value>153;(f.halfCarry||m)&&(u.value+=R),(f.carry||T)&&(u.value+=b,f.carry=!0),f.zero=u.value===0,f.halfCarry=!1},o.prototype.complementAccumulator=function(){this.A.value=~this.A.value,this.F.subtract=!0,this.F.halfCarry=!0},o.prototype.incrementMemoryValAtRegisterAddr=function(r){var u=this.memory.readByte(r.value),f=u+1&255;this.cpu.cycle(4),this.F.subtract=!1,this.F.zero=f===0,this.F.halfCarry=(f&15)<(u&15),this.memory.writeByte(r.value,f,"incrementMemoryValAtRegisterAddr"),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.decrementMemoryValAtRegisterAddr=function(r){var u=this.memory.readByte(r.value),f=u-1&255;this.cpu.cycle(4),this.F.subtract=!0,this.F.zero=f===0,this.F.halfCarry=(f&15)>(u&15),this.memory.writeByte(r.value,f,"decrementMemoryValAtRegisterAddr"),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.callFunction=function(){var r=this.memory.readWord(this.PC.value);this.PC.value+=2,this.pushToStack(this.PC.value),this.PC.value=r},o.prototype.callFunctionIfNotZero=function(){this.F.zero?this.PC.value+=2:this.callFunction()},o.prototype.callFunctionIfZero=function(){this.F.zero?this.callFunction():this.PC.value+=2},o.prototype.callFunctionIfNotCarry=function(){this.F.carry?this.PC.value+=2:this.callFunction()},o.prototype.callFunctionIfCarry=function(){this.F.carry?this.callFunction():this.PC.value+=2},o.prototype.returnFromFunction=function(){this.PC.value=this.popFromStack()},o.prototype.returnFromFunctionIfNotZero=function(){this.F.zero||this.returnFromFunction()},o.prototype.returnFromFunctionIfZero=function(){this.F.zero&&this.returnFromFunction()},o.prototype.returnFromFunctionIfCarry=function(){this.F.carry&&this.returnFromFunction()},o.prototype.returnFromFunctionIfNotCarry=function(){this.F.carry||this.returnFromFunction()},o.prototype.popFromStack=function(){var r=this.memory.readWord(this.SP.value);return this.SP.value+=2,r},o.prototype.restart=function(r){this.pushToStack(this.PC.value),this.PC.value=r},o.prototype.pushToStack=function(r){this.SP.value-=2,this.memory.writeWord(this.SP.value,r)},o.prototype.popToRegister=function(r){r.value=this.popFromStack()},o.prototype.pushFromRegister=function(r){this.pushToStack(r.value)},o.prototype.swap=function(r){this.cpu.cycle(4);var u=r.value&15,f=r.value>>4;r.value=(u<<4)+f,this.F.zero=r.value===0,this.F.carry=!1,this.F.subtract=!1,this.F.halfCarry=!1,this.cpu.cycle(4)},o.prototype.swapAtRegisterAddr=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r&15,f=r>>4,R=(u<<4)+f;this.F.zero=R===0,this.F.carry=!1,this.F.subtract=!1,this.F.halfCarry=!1,this.memory.writeByte(this.HL.value,R),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.testBit=function(r,u){this.cpu.cycle(4);var f=u.value>>r&1;this.F.zero=f===0,this.F.halfCarry=!0,this.F.subtract=!1,this.cpu.cycle(4)},o.prototype.testBitAtRegisterAddr=function(r){this.cpu.cycle(4);var u=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var f=u>>r&1;this.F.zero=f===0,this.F.halfCarry=!0,this.F.subtract=!1,this.cpu.cycle(4)},o.prototype.resetBit=function(r,u){this.cpu.cycle(4),u.value=u.value&~(1<<r),this.cpu.cycle(4)},o.prototype.resetBitAtRegisterAddr=function(r){this.cpu.cycle(4);var u=this.memory.readByte(this.HL.value);this.cpu.cycle(4),u=u&~(1<<r),this.memory.writeByte(this.HL.value,u),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.shiftLeft=function(r){this.cpu.cycle(4);var u=r.value>>7&1;r.value=r.value<<1&255,this.F.carry=u===1,this.F.subtract=!1,this.F.halfCarry=!1,this.F.zero=r.value===0,this.cpu.cycle(4)},o.prototype.shiftLeftAtRegisterAddr=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r>>7&1;r=r<<1&255,this.F.carry=u===1,this.F.subtract=!1,this.F.halfCarry=!1,this.F.zero=r===0,this.memory.writeByte(this.HL.value,r),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.shiftRight=function(r){this.cpu.cycle(4);var u=r.value>>7,f=r.value&1;r.value=r.value>>1&255,r.setBit(7,u),this.F.carry=f===1,this.F.subtract=!1,this.F.halfCarry=!1,this.F.zero=r.value===0,this.cpu.cycle(4)},o.prototype.shiftRightCarry=function(r){this.cpu.cycle(4);var u=r.value&1;r.value=r.value>>1&255,this.F.carry=u===1,this.F.zero=r.value===0,this.F.subtract=!1,this.F.halfCarry=!1,this.cpu.cycle(4)},o.prototype.shiftRightCarryAtRegisterAddr=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r&1;r=r>>1&255,r=r&-129,this.F.carry=u===1,this.F.zero=r===0,this.F.subtract=!1,this.F.halfCarry=!1,this.memory.writeByte(this.HL.value,r),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.shiftRightAtRegisterAddr=function(){this.cpu.cycle(4);var r=this.memory.readByte(this.HL.value);this.cpu.cycle(4);var u=r>>7,f=r&1;r=r>>1&255,r|=u<<7,this.F.carry=f===1,this.F.subtract=!1,this.F.halfCarry=!1,this.F.zero=r===0,this.memory.writeByte(this.HL.value,r),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.setBitAtRegisterAddress=function(r){this.cpu.cycle(4);var u=this.memory.readByte(this.HL.value);this.cpu.cycle(4),u|=1<<r,this.memory.writeByte(this.HL.value,u),this.cpu.cycle(4),this.cpu.cycle(4)},o.prototype.outputState=function(){console.log("register state:"),console.log({AF:this.AF.hexValue,BC:this.BC.hexValue,DE:this.DE.hexValue,HL:this.HL.hexValue,PC:this.PC.hexValue,SP:this.SP.hexValue})},o}();s.CPURegisters=h}),define("cpu/Instruction",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0})}),define("cpu/setCbMap",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.setCbMap=void 0;function l(){var e=this;this.cbMap.set(0,{name:"RLC B",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.B)}}),this.cbMap.set(1,{name:"RLC C",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.C)}}),this.cbMap.set(2,{name:"RLC D",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.D)}}),this.cbMap.set(3,{name:"RLC E",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.E)}}),this.cbMap.set(4,{name:"RLC H",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.H)}}),this.cbMap.set(5,{name:"RLC L",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.L)}}),this.cbMap.set(6,{name:"RLC (HL)",cycleTime:0,operation:function(){e.registers.rotateValueAtRegisterAddrLeft()}}),this.cbMap.set(7,{name:"RLC A",cycleTime:0,operation:function(){e.registers.rotateRegisterLeft(e.registers.A)}}),this.cbMap.set(8,{name:"RRC B",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.B)}}),this.cbMap.set(9,{name:"RRC C",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.C)}}),this.cbMap.set(10,{name:"RRC D",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.D)}}),this.cbMap.set(11,{name:"RRC E",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.E)}}),this.cbMap.set(12,{name:"RRC H",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.H)}}),this.cbMap.set(13,{name:"RRC L",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.L)}}),this.cbMap.set(14,{name:"RRC (HL)",cycleTime:0,operation:function(){e.registers.rotateValueAtRegisterAddrRight()}}),this.cbMap.set(15,{name:"RRC A",cycleTime:0,operation:function(){e.registers.rotateRegisterRight(e.registers.A)}}),this.cbMap.set(16,{name:"RL B",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.B)}}),this.cbMap.set(17,{name:"RL C",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.C)}}),this.cbMap.set(18,{name:"RL D",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.D)}}),this.cbMap.set(19,{name:"RL E",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.E)}}),this.cbMap.set(20,{name:"RL H",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.H)}}),this.cbMap.set(21,{name:"RL L",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.L)}}),this.cbMap.set(22,{name:"RL (HL)",cycleTime:0,operation:function(){e.registers.rotateAtRegisterAddrLeftCarry()}}),this.cbMap.set(23,{name:"RL A",cycleTime:0,operation:function(){e.registers.rotateRegisterLeftCarry(e.registers.A)}}),this.cbMap.set(24,{name:"RR B",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.B)}}),this.cbMap.set(25,{name:"RR C",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.C)}}),this.cbMap.set(26,{name:"RR D",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.D)}}),this.cbMap.set(27,{name:"RR E",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.E)}}),this.cbMap.set(28,{name:"RR H",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.H)}}),this.cbMap.set(29,{name:"RR L",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.L)}}),this.cbMap.set(30,{name:"RR (HL)",cycleTime:0,operation:function(){e.registers.rotateAtRegisterAddrRightCarry()}}),this.cbMap.set(31,{name:"RR A",cycleTime:0,operation:function(){e.registers.rotateRegisterRightCarry(e.registers.A)}}),this.cbMap.set(32,{name:"SLA B",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.B)}}),this.cbMap.set(33,{name:"SLA C",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.C)}}),this.cbMap.set(34,{name:"SLA D",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.D)}}),this.cbMap.set(35,{name:"SLA E",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.E)}}),this.cbMap.set(36,{name:"SLA H",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.H)}}),this.cbMap.set(37,{name:"SLA L",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.L)}}),this.cbMap.set(38,{name:"SLA (HL)",cycleTime:0,operation:function(){e.registers.shiftLeftAtRegisterAddr()}}),this.cbMap.set(39,{name:"SLA A",cycleTime:0,operation:function(){e.registers.shiftLeft(e.registers.A)}}),this.cbMap.set(40,{name:"SRA B",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.B)}}),this.cbMap.set(41,{name:"SRA C",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.C)}}),this.cbMap.set(42,{name:"SRA D",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.D)}}),this.cbMap.set(43,{name:"SRA E",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.E)}}),this.cbMap.set(44,{name:"SRA H",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.H)}}),this.cbMap.set(45,{name:"SRA L",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.L)}}),this.cbMap.set(46,{name:"SRA (HL)",cycleTime:0,operation:function(){e.registers.shiftRightAtRegisterAddr()}}),this.cbMap.set(47,{name:"SRA A",cycleTime:0,operation:function(){e.registers.shiftRight(e.registers.A)}}),this.cbMap.set(48,{name:"SWAP B",cycleTime:0,operation:function(){e.registers.swap(e.registers.B)}}),this.cbMap.set(49,{name:"SWAP C",cycleTime:0,operation:function(){e.registers.swap(e.registers.C)}}),this.cbMap.set(50,{name:"SWAP D",cycleTime:0,operation:function(){e.registers.swap(e.registers.D)}}),this.cbMap.set(51,{name:"SWAP E",cycleTime:0,operation:function(){e.registers.swap(e.registers.E)}}),this.cbMap.set(52,{name:"SWAP H",cycleTime:0,operation:function(){e.registers.swap(e.registers.H)}}),this.cbMap.set(53,{name:"SWAP L",cycleTime:0,operation:function(){e.registers.swap(e.registers.L)}}),this.cbMap.set(54,{name:"SWAP (HL)",cycleTime:0,operation:function(){e.registers.swapAtRegisterAddr()}}),this.cbMap.set(55,{name:"SWAP A",cycleTime:0,operation:function(){e.registers.swap(e.registers.A)}}),this.cbMap.set(56,{name:"SRL B",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.B)}}),this.cbMap.set(57,{name:"SRL C",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.C)}}),this.cbMap.set(58,{name:"SRL D",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.D)}}),this.cbMap.set(59,{name:"SRL E",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.E)}}),this.cbMap.set(60,{name:"SRL H",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.H)}}),this.cbMap.set(61,{name:"SRL L",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.L)}}),this.cbMap.set(62,{name:"SRL (HL)",cycleTime:0,operation:function(){e.registers.shiftRightCarryAtRegisterAddr()}}),this.cbMap.set(63,{name:"SRL A",cycleTime:0,operation:function(){e.registers.shiftRightCarry(e.registers.A)}}),this.cbMap.set(64,{name:"BIT 0, B",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.B)}}),this.cbMap.set(65,{name:"BIT 0, C",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.C)}}),this.cbMap.set(66,{name:"BIT 0, D",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.D)}}),this.cbMap.set(67,{name:"BIT 0, E",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.E)}}),this.cbMap.set(68,{name:"BIT 0, H",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.H)}}),this.cbMap.set(69,{name:"BIT 0, L",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.L)}}),this.cbMap.set(70,{name:"BIT 0, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(0)}}),this.cbMap.set(71,{name:"BIT 0, A",cycleTime:0,operation:function(){e.registers.testBit(0,e.registers.A)}}),this.cbMap.set(72,{name:"BIT 1, B",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.B)}}),this.cbMap.set(73,{name:"BIT 1, C",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.C)}}),this.cbMap.set(74,{name:"BIT 1, D",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.D)}}),this.cbMap.set(75,{name:"BIT 1, E",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.E)}}),this.cbMap.set(76,{name:"BIT 1, H",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.H)}}),this.cbMap.set(77,{name:"BIT 1, L",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.L)}}),this.cbMap.set(78,{name:"BIT 1, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(1)}}),this.cbMap.set(79,{name:"BIT 1, A",cycleTime:0,operation:function(){e.registers.testBit(1,e.registers.A)}}),this.cbMap.set(80,{name:"BIT 2, B",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.B)}}),this.cbMap.set(81,{name:"BIT 2, C",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.C)}}),this.cbMap.set(82,{name:"BIT 2, D",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.D)}}),this.cbMap.set(83,{name:"BIT 2, E",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.E)}}),this.cbMap.set(84,{name:"BIT 2, H",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.H)}}),this.cbMap.set(85,{name:"BIT 2, L",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.L)}}),this.cbMap.set(86,{name:"BIT 2, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(2)}}),this.cbMap.set(87,{name:"BIT 2, A",cycleTime:0,operation:function(){e.registers.testBit(2,e.registers.A)}}),this.cbMap.set(88,{name:"BIT 3, B",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.B)}}),this.cbMap.set(89,{name:"BIT 3, C",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.C)}}),this.cbMap.set(90,{name:"BIT 3, D",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.D)}}),this.cbMap.set(91,{name:"BIT 3, E",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.E)}}),this.cbMap.set(92,{name:"BIT 3, H",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.H)}}),this.cbMap.set(93,{name:"BIT 3, L",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.L)}}),this.cbMap.set(94,{name:"BIT 3, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(3)}}),this.cbMap.set(95,{name:"BIT 3, A",cycleTime:0,operation:function(){e.registers.testBit(3,e.registers.A)}}),this.cbMap.set(96,{name:"BIT 4, B",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.B)}}),this.cbMap.set(97,{name:"BIT 4, C",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.C)}}),this.cbMap.set(98,{name:"BIT 4, D",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.D)}}),this.cbMap.set(99,{name:"BIT 4, E",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.E)}}),this.cbMap.set(100,{name:"BIT 4, H",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.H)}}),this.cbMap.set(101,{name:"BIT 4, L",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.L)}}),this.cbMap.set(102,{name:"BIT 4, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(4)}}),this.cbMap.set(103,{name:"BIT 4, A",cycleTime:0,operation:function(){e.registers.testBit(4,e.registers.A)}}),this.cbMap.set(104,{name:"BIT 5, B",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.B)}}),this.cbMap.set(105,{name:"BIT 5, C",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.C)}}),this.cbMap.set(106,{name:"BIT 5, D",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.D)}}),this.cbMap.set(107,{name:"BIT 5, E",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.E)}}),this.cbMap.set(108,{name:"BIT 5, H",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.H)}}),this.cbMap.set(109,{name:"BIT 5, L",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.L)}}),this.cbMap.set(110,{name:"BIT 5, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(5)}}),this.cbMap.set(111,{name:"BIT 5, A",cycleTime:0,operation:function(){e.registers.testBit(5,e.registers.A)}}),this.cbMap.set(112,{name:"BIT 6, B",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.B)}}),this.cbMap.set(113,{name:"BIT 6, C",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.C)}}),this.cbMap.set(114,{name:"BIT 6, D",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.D)}}),this.cbMap.set(115,{name:"BIT 6, E",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.E)}}),this.cbMap.set(116,{name:"BIT 6, H",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.H)}}),this.cbMap.set(117,{name:"BIT 6, L",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.L)}}),this.cbMap.set(118,{name:"BIT 6, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(6)}}),this.cbMap.set(119,{name:"BIT 6, A",cycleTime:0,operation:function(){e.registers.testBit(6,e.registers.A)}}),this.cbMap.set(120,{name:"BIT 7, B",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.B)}}),this.cbMap.set(121,{name:"BIT 7, C",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.C)}}),this.cbMap.set(122,{name:"BIT 7, D",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.D)}}),this.cbMap.set(123,{name:"BIT 7, E",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.E)}}),this.cbMap.set(124,{name:"BIT 7, H",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.H)}}),this.cbMap.set(125,{name:"BIT 7, L",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.L)}}),this.cbMap.set(126,{name:"BIT 7, (HL)",cycleTime:0,operation:function(){e.registers.testBitAtRegisterAddr(7)}}),this.cbMap.set(127,{name:"BIT 7, A",cycleTime:0,operation:function(){e.registers.testBit(7,e.registers.A)}}),this.cbMap.set(128,{name:"RES 0, B",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.B)}}),this.cbMap.set(129,{name:"RES 0, C",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.C)}}),this.cbMap.set(130,{name:"RES 0, D",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.D)}}),this.cbMap.set(131,{name:"RES 0, E",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.E)}}),this.cbMap.set(132,{name:"RES 0, H",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.H)}}),this.cbMap.set(133,{name:"RES 0, L",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.L)}}),this.cbMap.set(134,{name:"RES 0, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(0)}}),this.cbMap.set(135,{name:"RES 0, A",cycleTime:0,operation:function(){e.registers.resetBit(0,e.registers.A)}}),this.cbMap.set(136,{name:"RES 1, B",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.B)}}),this.cbMap.set(137,{name:"RES 1, C",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.C)}}),this.cbMap.set(138,{name:"RES 1, D",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.D)}}),this.cbMap.set(139,{name:"RES 1, E",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.E)}}),this.cbMap.set(140,{name:"RES 1, H",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.H)}}),this.cbMap.set(141,{name:"RES 1, L",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.L)}}),this.cbMap.set(142,{name:"RES 1, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(1)}}),this.cbMap.set(143,{name:"RES 1, A",cycleTime:0,operation:function(){e.registers.resetBit(1,e.registers.A)}}),this.cbMap.set(144,{name:"RES 2, B",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.B)}}),this.cbMap.set(145,{name:"RES 2, C",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.C)}}),this.cbMap.set(146,{name:"RES 2, D",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.D)}}),this.cbMap.set(147,{name:"RES 2, E",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.E)}}),this.cbMap.set(148,{name:"RES 2, H",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.H)}}),this.cbMap.set(149,{name:"RES 2, L",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.L)}}),this.cbMap.set(150,{name:"RES 2, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(2)}}),this.cbMap.set(151,{name:"RES 2, A",cycleTime:0,operation:function(){e.registers.resetBit(2,e.registers.A)}}),this.cbMap.set(152,{name:"RES 3, B",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.B)}}),this.cbMap.set(153,{name:"RES 3, C",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.C)}}),this.cbMap.set(154,{name:"RES 3, D",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.D)}}),this.cbMap.set(155,{name:"RES 3, E",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.E)}}),this.cbMap.set(156,{name:"RES 3, H",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.H)}}),this.cbMap.set(157,{name:"RES 3, L",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.L)}}),this.cbMap.set(158,{name:"RES 3, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(3)}}),this.cbMap.set(159,{name:"RES 3, A",cycleTime:0,operation:function(){e.registers.resetBit(3,e.registers.A)}}),this.cbMap.set(160,{name:"RES 4, B",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.B)}}),this.cbMap.set(161,{name:"RES 4, C",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.C)}}),this.cbMap.set(162,{name:"RES 4, D",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.D)}}),this.cbMap.set(163,{name:"RES 4, E",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.E)}}),this.cbMap.set(164,{name:"RES 4, H",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.H)}}),this.cbMap.set(165,{name:"RES 4, L",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.L)}}),this.cbMap.set(166,{name:"RES 4, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(4)}}),this.cbMap.set(167,{name:"RES 4, A",cycleTime:0,operation:function(){e.registers.resetBit(4,e.registers.A)}}),this.cbMap.set(168,{name:"RES 5, B",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.B)}}),this.cbMap.set(169,{name:"RES 5, C",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.C)}}),this.cbMap.set(170,{name:"RES 5, D",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.D)}}),this.cbMap.set(171,{name:"RES 5, E",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.E)}}),this.cbMap.set(172,{name:"RES 5, H",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.H)}}),this.cbMap.set(173,{name:"RES 5, L",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.L)}}),this.cbMap.set(174,{name:"RES 5, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(5)}}),this.cbMap.set(175,{name:"RES 5, A",cycleTime:0,operation:function(){e.registers.resetBit(5,e.registers.A)}}),this.cbMap.set(176,{name:"RES 6, B",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.B)}}),this.cbMap.set(177,{name:"RES 6, C",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.C)}}),this.cbMap.set(178,{name:"RES 6, D",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.D)}}),this.cbMap.set(179,{name:"RES 6, E",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.E)}}),this.cbMap.set(180,{name:"RES 6, H",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.H)}}),this.cbMap.set(181,{name:"RES 6, L",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.L)}}),this.cbMap.set(182,{name:"RES 6, (HL)",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(6)}}),this.cbMap.set(183,{name:"RES 6, A",cycleTime:0,operation:function(){e.registers.resetBit(6,e.registers.A)}}),this.cbMap.set(184,{name:"RES 7, B",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.B)}}),this.cbMap.set(185,{name:"RES 7, C",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.C)}}),this.cbMap.set(186,{name:"RES 7, D",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.D)}}),this.cbMap.set(187,{name:"RES 7, E",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.E)}}),this.cbMap.set(188,{name:"RES 7 H",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.H)}}),this.cbMap.set(189,{name:"RES 7, L",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.L)}}),this.cbMap.set(190,{name:"RES 7, (HL) ",cycleTime:0,operation:function(){e.registers.resetBitAtRegisterAddr(7)}}),this.cbMap.set(191,{name:"RES 7, A",cycleTime:0,operation:function(){e.registers.resetBit(7,e.registers.A)}}),this.cbMap.set(192,{name:"SET 0, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(0,1),e.cycle(4)}}),this.cbMap.set(193,{name:"SET 0, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(0,1),e.cycle(4)}}),this.cbMap.set(194,{name:"SET 0, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(0,1),e.cycle(4)}}),this.cbMap.set(195,{name:"SET 0, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(0,1),e.cycle(4)}}),this.cbMap.set(196,{name:"SET 0, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(0,1),e.cycle(4)}}),this.cbMap.set(197,{name:"SET 0, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(0,1),e.cycle(4)}}),this.cbMap.set(198,{name:"SET 0, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(0)}}),this.cbMap.set(199,{name:"SET 0, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(0,1),e.cycle(4)}}),this.cbMap.set(200,{name:"SET 1, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(1,1),e.cycle(4)}}),this.cbMap.set(201,{name:"SET 1, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(1,1),e.cycle(4)}}),this.cbMap.set(202,{name:"SET 1, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(1,1),e.cycle(4)}}),this.cbMap.set(203,{name:"SET 1, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(1,1),e.cycle(4)}}),this.cbMap.set(204,{name:"SET 1, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(1,1),e.cycle(4)}}),this.cbMap.set(205,{name:"SET 1, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(1,1),e.cycle(4)}}),this.cbMap.set(206,{name:"SET 1, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(1)}}),this.cbMap.set(207,{name:"SET 1, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(1,1),e.cycle(4)}}),this.cbMap.set(208,{name:"SET 2, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(2,1),e.cycle(4)}}),this.cbMap.set(209,{name:"SET 2, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(2,1),e.cycle(4)}}),this.cbMap.set(210,{name:"SET 2, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(2,1),e.cycle(4)}}),this.cbMap.set(211,{name:"SET 2, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(2,1),e.cycle(4)}}),this.cbMap.set(212,{name:"SET 2, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(2,1),e.cycle(4)}}),this.cbMap.set(213,{name:"SET 2, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(2,1),e.cycle(4)}}),this.cbMap.set(214,{name:"SET 2, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(2)}}),this.cbMap.set(215,{name:"SET 2, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(2,1),e.cycle(4)}}),this.cbMap.set(216,{name:"SET 3, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(3,1),e.cycle(4)}}),this.cbMap.set(217,{name:"SET 3, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(3,1),e.cycle(4)}}),this.cbMap.set(218,{name:"SET 3, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(3,1),e.cycle(4)}}),this.cbMap.set(219,{name:"SET 3, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(3,1),e.cycle(4)}}),this.cbMap.set(220,{name:"SET 3, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(3,1),e.cycle(4)}}),this.cbMap.set(221,{name:"SET 3, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(3,1),e.cycle(4)}}),this.cbMap.set(222,{name:"SET 3, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(3)}}),this.cbMap.set(223,{name:"SET 3, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(3,1),e.cycle(4)}}),this.cbMap.set(224,{name:"SET 4, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(4,1),e.cycle(4)}}),this.cbMap.set(225,{name:"SET 4, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(4,1),e.cycle(4)}}),this.cbMap.set(226,{name:"SET 4, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(4,1),e.cycle(4)}}),this.cbMap.set(227,{name:"SET 4, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(4,1),e.cycle(4)}}),this.cbMap.set(228,{name:"SET 4, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(4,1),e.cycle(4)}}),this.cbMap.set(229,{name:"SET 4, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(4,1),e.cycle(4)}}),this.cbMap.set(230,{name:"SET 4, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(4)}}),this.cbMap.set(231,{name:"SET 4, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(4,1),e.cycle(4)}}),this.cbMap.set(232,{name:"SET 5, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(5,1),e.cycle(4)}}),this.cbMap.set(233,{name:"SET 5, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(5,1),e.cycle(4)}}),this.cbMap.set(234,{name:"SET 5, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(5,1),e.cycle(4)}}),this.cbMap.set(235,{name:"SET 5, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(5,1),e.cycle(4)}}),this.cbMap.set(236,{name:"SET 5, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(5,1),e.cycle(4)}}),this.cbMap.set(237,{name:"SET 5, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(5,1),e.cycle(4)}}),this.cbMap.set(238,{name:"SET 5, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(5)}}),this.cbMap.set(239,{name:"SET 5, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(5,1),e.cycle(4)}}),this.cbMap.set(240,{name:"SET 6, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(6,1),e.cycle(4)}}),this.cbMap.set(241,{name:"SET 6, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(6,1),e.cycle(4)}}),this.cbMap.set(242,{name:"SET 6, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(6,1),e.cycle(4)}}),this.cbMap.set(243,{name:"SET 6, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(6,1),e.cycle(4)}}),this.cbMap.set(244,{name:"set 6, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(6,1),e.cycle(4)}}),this.cbMap.set(245,{name:"SET 6, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(6,1),e.cycle(4)}}),this.cbMap.set(246,{name:"SET 6, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(6)}}),this.cbMap.set(247,{name:"SET 6, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(6,1),e.cycle(4)}}),this.cbMap.set(248,{name:"SET 7, B",cycleTime:0,operation:function(){e.cycle(4),e.registers.B.setBit(7,1),e.cycle(4)}}),this.cbMap.set(249,{name:"SET 7, C",cycleTime:0,operation:function(){e.cycle(4),e.registers.C.setBit(7,1),e.cycle(4)}}),this.cbMap.set(250,{name:"SET 7, D",cycleTime:0,operation:function(){e.cycle(4),e.registers.D.setBit(7,1),e.cycle(4)}}),this.cbMap.set(251,{name:"SET 7, E",cycleTime:0,operation:function(){e.cycle(4),e.registers.E.setBit(7,1),e.cycle(4)}}),this.cbMap.set(252,{name:"SET 7, H",cycleTime:0,operation:function(){e.cycle(4),e.registers.H.setBit(7,1),e.cycle(4)}}),this.cbMap.set(253,{name:"SET 7, L",cycleTime:0,operation:function(){e.cycle(4),e.registers.L.setBit(7,1),e.cycle(4)}}),this.cbMap.set(254,{name:"SET 7, (HL)",cycleTime:0,operation:function(){e.registers.setBitAtRegisterAddress(7)}}),this.cbMap.set(255,{name:"SET 7, A",cycleTime:0,operation:function(){e.cycle(4),e.registers.A.setBit(7,1),e.cycle(4)}})}s.setCbMap=l}),define("cpu/setInstructionMap",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.setInstructionMap=void 0;function l(){var e=this,n=this,t=n.registers,i=n.memory;this.instructionMap.set(0,{name:"NOP",cycleTime:4,operation:function(){}}),this.instructionMap.set(1,{get name(){return"LD BC, 0x".concat(i.readWord(t.PC.value).toString(16))},cycleTime:12,operation:function(){e.registers.loadWord(e.registers.BC)}}),this.instructionMap.set(2,{name:"LD (BC), A",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.BC,e.registers.A)}}),this.instructionMap.set(3,{name:"INC BC",cycleTime:8,operation:function(){e.registers.BC.value++}}),this.instructionMap.set(4,{name:"INC B",cycleTime:4,operation:function(){e.registers.increment(e.registers.B)}}),this.instructionMap.set(5,{name:"DEC B",cycleTime:4,operation:function(){e.registers.decrement(e.registers.B)}}),this.instructionMap.set(6,{get name(){return"LD B, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.B)}}),this.instructionMap.set(7,{name:"RLCA",cycleTime:4,operation:function(){e.registers.rotateLeft()}}),this.instructionMap.set(8,{get name(){return"LD (0x".concat(i.readWord(t.PC.value).toString(16),"), SP")},cycleTime:20,operation:function(){e.registers.writeStackPointerToMemory()}}),this.instructionMap.set(9,{name:"ADD HL, BC",cycleTime:8,operation:function(){e.registers.add16Bit(e.registers.HL,e.registers.BC)}}),this.instructionMap.set(10,{name:"LD A, (BC)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.A,e.registers.BC)}}),this.instructionMap.set(11,{name:"DEC BC",cycleTime:8,operation:function(){e.registers.BC.value--}}),this.instructionMap.set(12,{name:"INC C",cycleTime:4,operation:function(){e.registers.increment(e.registers.C)}}),this.instructionMap.set(13,{name:"DEC C",cycleTime:4,operation:function(){e.registers.decrement(e.registers.C)}}),this.instructionMap.set(14,{get name(){return"LD C, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.C)}}),this.instructionMap.set(15,{name:"RRCA",cycleTime:4,operation:function(){e.registers.rotateRight()}}),this.instructionMap.set(16,{name:"STOP 0",cycleTime:4,operation:function(){e.isStopped=!0}}),this.instructionMap.set(17,{get name(){return"LD DE, 0x".concat(i.readWord(t.PC.value).toString(16))},cycleTime:12,operation:function(){e.registers.loadWord(e.registers.DE)}}),this.instructionMap.set(18,{name:"LD (DE), A",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.DE,e.registers.A)}}),this.instructionMap.set(19,{name:"INC DE",cycleTime:8,operation:function(){e.registers.DE.value++}}),this.instructionMap.set(20,{name:"INC D",cycleTime:4,operation:function(){e.registers.increment(e.registers.D)}}),this.instructionMap.set(21,{name:"DEC D",cycleTime:4,operation:function(){e.registers.decrement(e.registers.D)}}),this.instructionMap.set(22,{get name(){return"LD D, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.D)}}),this.instructionMap.set(23,{name:"RLA",cycleTime:4,operation:function(){e.registers.rotateLeftCarry()}}),this.instructionMap.set(24,{get name(){return"JR 0x".concat(i.readSignedByte(t.PC.value).toString(16))},cycleTime:12,operation:function(){e.registers.relativeJump()}}),this.instructionMap.set(25,{name:"ADD HL, DE",cycleTime:8,operation:function(){e.registers.add16Bit(e.registers.HL,e.registers.DE)}}),this.instructionMap.set(26,{name:"LD A, (DE)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.A,e.registers.DE)}}),this.instructionMap.set(27,{name:"DEC DE",cycleTime:8,operation:function(){e.registers.DE.value--}}),this.instructionMap.set(28,{name:"INC E",cycleTime:4,operation:function(){e.registers.increment(e.registers.E)}}),this.instructionMap.set(29,{name:"DEC E",cycleTime:4,operation:function(){e.registers.decrement(e.registers.E)}}),this.instructionMap.set(30,{get name(){return"LD E, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.E)}}),this.instructionMap.set(31,{name:"RRA",cycleTime:4,operation:function(){e.registers.rotateRightCarry()}}),this.instructionMap.set(32,{get name(){return"JR NZ, 0x".concat(i.readSignedByte(t.PC.value).toString(16))},get cycleTime(){return t.F.zero?8:12},operation:function(){e.registers.relativeJumpIfNotZero()}}),this.instructionMap.set(33,{get name(){return"LD HL, 0x".concat(i.readWord(t.PC.value).toString(16))},cycleTime:12,operation:function(){e.registers.loadWord(e.registers.HL)}}),this.instructionMap.set(34,{name:"LD (HL+), A",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddrAndIncrementTarget(e.registers.HL,e.registers.A)}}),this.instructionMap.set(35,{name:"INC HL",cycleTime:8,operation:function(){e.registers.HL.value++}}),this.instructionMap.set(36,{name:"INC H",cycleTime:4,operation:function(){e.registers.increment(e.registers.H)}}),this.instructionMap.set(37,{name:"DEC H",cycleTime:4,operation:function(){e.registers.decrement(e.registers.H)}}),this.instructionMap.set(38,{get name(){return"LD H, ".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.H)}}),this.instructionMap.set(39,{name:"DAA",cycleTime:4,operation:function(){e.registers.decimalAdjustAccumulator()}}),this.instructionMap.set(40,{get name(){return"JR Z, 0x".concat(i.readSignedByte(t.PC.value).toString(16))},get cycleTime(){return t.F.zero?12:8},operation:function(){e.registers.relativeJumpIfZero()}}),this.instructionMap.set(41,{name:"ADD HL, HL",cycleTime:8,operation:function(){e.registers.add16Bit(e.registers.HL,e.registers.HL)}}),this.instructionMap.set(42,{name:"LD A, (HL+)",cycleTime:8,operation:function(){e.registers.loadByteAndIncrementSource(e.registers.A,e.registers.HL)}}),this.instructionMap.set(43,{name:"DEC HL",cycleTime:8,operation:function(){e.registers.HL.value--}}),this.instructionMap.set(44,{name:"INC L",cycleTime:4,operation:function(){e.registers.increment(e.registers.L)}}),this.instructionMap.set(45,{name:"DEC L",cycleTime:4,operation:function(){e.registers.decrement(e.registers.L)}}),this.instructionMap.set(46,{get name(){return"LD L, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.L)}}),this.instructionMap.set(47,{name:"CPL",cycleTime:4,operation:function(){e.registers.complementAccumulator()}}),this.instructionMap.set(48,{get name(){return"JR NC, 0x".concat(i.readSignedByte(t.PC.value).toString(16))},get cycleTime(){return t.F.carry?8:12},operation:function(){e.registers.relativeJumpIfNotCarry()}}),this.instructionMap.set(49,{get name(){return"LD SP, 0x".concat(i.readWord(t.PC.value).toString(16))},cycleTime:12,operation:function(){e.registers.loadWord(e.registers.SP)}}),this.instructionMap.set(50,{name:"LD (HL-), A",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddrAndDecrementTarget(e.registers.HL,e.registers.A)}}),this.instructionMap.set(51,{name:"INC SP",cycleTime:8,operation:function(){e.registers.SP.value++}}),this.instructionMap.set(52,{name:"INC (HL)",cycleTime:0,operation:function(){e.registers.incrementMemoryValAtRegisterAddr(e.registers.HL)}}),this.instructionMap.set(53,{name:"DEC (HL)",cycleTime:0,operation:function(){e.registers.decrementMemoryValAtRegisterAddr(e.registers.HL)}}),this.instructionMap.set(54,{get name(){return"LD (HL), 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:0,operation:function(){e.registers.writeByteIntoRegisterAddress(e.registers.HL)}}),this.instructionMap.set(55,{name:"SCF",cycleTime:4,operation:function(){e.registers.setCarryFlag()}}),this.instructionMap.set(56,{get name(){return"JR C, 0x".concat(i.readSignedByte(t.PC.value).toString(16))},get cycleTime(){return t.F.carry?12:8},operation:function(){e.registers.relativeJumpIfCarry()}}),this.instructionMap.set(57,{name:"ADD HL, SP",cycleTime:8,operation:function(){e.registers.add16Bit(e.registers.HL,e.registers.SP)}}),this.instructionMap.set(58,{name:"LD A, (HL-)",cycleTime:8,operation:function(){e.registers.loadByteAndDecrementSource(e.registers.A,e.registers.HL)}}),this.instructionMap.set(59,{name:"DEC SP",cycleTime:8,operation:function(){e.registers.SP.value--}}),this.instructionMap.set(60,{name:"INC A",cycleTime:4,operation:function(){e.registers.increment(e.registers.A)}}),this.instructionMap.set(61,{name:"DEC A",cycleTime:4,operation:function(){e.registers.decrement(e.registers.A)}}),this.instructionMap.set(62,{get name(){return"LD A, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.readByte(e.registers.A)}}),this.instructionMap.set(63,{name:"CCF",cycleTime:4,operation:function(){e.registers.complementCarryFlag()}}),this.instructionMap.set(64,{name:"LD B, B",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.B)}}),this.instructionMap.set(65,{name:"LD B, C",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.C)}}),this.instructionMap.set(66,{name:"LD B, D",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.D)}}),this.instructionMap.set(67,{name:"LD B, E",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.E)}}),this.instructionMap.set(68,{name:"LD B, H",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.H)}}),this.instructionMap.set(69,{name:"LD B, L",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.L)}}),this.instructionMap.set(70,{name:"LD B, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.B,e.registers.HL)}}),this.instructionMap.set(71,{name:"LD B, A",cycleTime:4,operation:function(){e.registers.load(e.registers.B,e.registers.A)}}),this.instructionMap.set(72,{name:"LD C, B",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.B)}}),this.instructionMap.set(73,{name:"LD C, C",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.C)}}),this.instructionMap.set(74,{name:"LD C, D",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.D)}}),this.instructionMap.set(75,{name:"LD C, E",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.E)}}),this.instructionMap.set(76,{name:"LD C, H",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.H)}}),this.instructionMap.set(77,{name:"LD C, L",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.L)}}),this.instructionMap.set(78,{name:"LD C, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.C,e.registers.HL)}}),this.instructionMap.set(79,{name:"LD C, A",cycleTime:4,operation:function(){e.registers.load(e.registers.C,e.registers.A)}}),this.instructionMap.set(80,{name:"LD D, B",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.B)}}),this.instructionMap.set(81,{name:"LD D, C",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.C)}}),this.instructionMap.set(82,{name:"LD D, D",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.D)}}),this.instructionMap.set(83,{name:"LD D, E",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.E)}}),this.instructionMap.set(84,{name:"LD D, H",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.H)}}),this.instructionMap.set(85,{name:"LD D, L",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.L)}}),this.instructionMap.set(86,{name:"LD D, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.D,e.registers.HL)}}),this.instructionMap.set(87,{name:"LD D, A",cycleTime:4,operation:function(){e.registers.load(e.registers.D,e.registers.A)}}),this.instructionMap.set(88,{name:"LD E, B",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.B)}}),this.instructionMap.set(89,{name:"LD E, C",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.C)}}),this.instructionMap.set(90,{name:"LD E, D",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.D)}}),this.instructionMap.set(91,{name:"E, E",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.E)}}),this.instructionMap.set(92,{name:"LD E, H",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.H)}}),this.instructionMap.set(93,{name:"LD E, L",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.L)}}),this.instructionMap.set(94,{name:"LD E, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.E,e.registers.HL)}}),this.instructionMap.set(95,{name:"LD E, A",cycleTime:4,operation:function(){e.registers.load(e.registers.E,e.registers.A)}}),this.instructionMap.set(96,{name:"LD H, B",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.B)}}),this.instructionMap.set(97,{name:"LD H, C",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.C)}}),this.instructionMap.set(98,{name:"LD H, D",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.D)}}),this.instructionMap.set(99,{name:"LD H, E",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.E)}}),this.instructionMap.set(100,{name:"LD H, H",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.H)}}),this.instructionMap.set(101,{name:"LD H, L",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.L)}}),this.instructionMap.set(102,{name:"LD H, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.H,e.registers.HL)}}),this.instructionMap.set(103,{name:"LD H, A",cycleTime:4,operation:function(){e.registers.load(e.registers.H,e.registers.A)}}),this.instructionMap.set(104,{name:"LD L, B",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.B)}}),this.instructionMap.set(105,{name:"LD L, C",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.C)}}),this.instructionMap.set(106,{name:"LD L, D",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.D)}}),this.instructionMap.set(107,{name:"LD L, E",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.E)}}),this.instructionMap.set(108,{name:"LD L, H",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.H)}}),this.instructionMap.set(109,{name:"LD L, L",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.L)}}),this.instructionMap.set(110,{name:"LD L, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.L,e.registers.HL)}}),this.instructionMap.set(111,{name:"LD L, A",cycleTime:4,operation:function(){e.registers.load(e.registers.L,e.registers.A)}}),this.instructionMap.set(112,{name:"LD (HL), B",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.B)}}),this.instructionMap.set(113,{name:"LD (HL) C",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.C)}}),this.instructionMap.set(114,{name:"LD (HL), D",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.D)}}),this.instructionMap.set(115,{name:"LD (HL), E",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.E)}}),this.instructionMap.set(116,{name:"LD (HL), H",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.H)}}),this.instructionMap.set(117,{name:"LD (HL), L",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.L)}}),this.instructionMap.set(118,{name:"HALT",cycleTime:4,operation:function(){e.isHalted=!0}}),this.instructionMap.set(119,{name:"LD (HL), A",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr(e.registers.HL,e.registers.A)}}),this.instructionMap.set(120,{name:"LD A, B",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.B)}}),this.instructionMap.set(121,{name:"LD A, C",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.C)}}),this.instructionMap.set(122,{name:"LD A, D",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.D)}}),this.instructionMap.set(123,{name:"LD A, E",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.E)}}),this.instructionMap.set(124,{name:"LD A, H",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.H)}}),this.instructionMap.set(125,{name:"LD A, L",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.L)}}),this.instructionMap.set(126,{name:"LD A, (HL)",cycleTime:8,operation:function(){e.registers.loadByte(e.registers.A,e.registers.HL)}}),this.instructionMap.set(127,{name:"LD A, A",cycleTime:4,operation:function(){e.registers.load(e.registers.A,e.registers.A)}}),this.instructionMap.set(128,{name:"ADD A, B",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.B)}}),this.instructionMap.set(129,{name:"ADD A, C",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.C)}}),this.instructionMap.set(130,{name:"ADD A, D",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.D)}}),this.instructionMap.set(131,{name:"ADD A, E",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.E)}}),this.instructionMap.set(132,{name:"ADD A, H",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.H)}}),this.instructionMap.set(133,{name:"ADD A, L",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.L)}}),this.instructionMap.set(134,{name:"ADD A, (HL)",cycleTime:8,operation:function(){e.registers.addFromRegisterAddr(e.registers.A,e.registers.HL)}}),this.instructionMap.set(135,{name:"ADD A, A",cycleTime:4,operation:function(){e.registers.add(e.registers.A,e.registers.A)}}),this.instructionMap.set(136,{name:"ADC A, B",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.B)}}),this.instructionMap.set(137,{name:"ADC A, C",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.C)}}),this.instructionMap.set(138,{name:"ADC A, D",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.D)}}),this.instructionMap.set(139,{name:"ADC A, E",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.E)}}),this.instructionMap.set(140,{name:"ADC A, H",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.H)}}),this.instructionMap.set(141,{name:"ADC A, L",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.L)}}),this.instructionMap.set(142,{name:"ADC A, (HL)",cycleTime:8,operation:function(){e.registers.addWithCarryFromMemory(e.registers.HL)}}),this.instructionMap.set(143,{name:"ADC A, A",cycleTime:4,operation:function(){e.registers.addWithCarry(e.registers.A)}}),this.instructionMap.set(144,{name:"SUB B",cycleTime:4,operation:function(){e.registers.subtract(e.registers.B)}}),this.instructionMap.set(145,{name:"SUB C",cycleTime:4,operation:function(){e.registers.subtract(e.registers.C)}}),this.instructionMap.set(146,{name:"SUB D",cycleTime:4,operation:function(){e.registers.subtract(e.registers.D)}}),this.instructionMap.set(147,{name:"SUB E",cycleTime:4,operation:function(){e.registers.subtract(e.registers.E)}}),this.instructionMap.set(148,{name:"SUB H",cycleTime:4,operation:function(){e.registers.subtract(e.registers.H)}}),this.instructionMap.set(149,{name:"SUB L",cycleTime:4,operation:function(){e.registers.subtract(e.registers.L)}}),this.instructionMap.set(150,{name:"SUB (HL)",cycleTime:8,operation:function(){e.registers.subtractFromMemory(e.registers.HL)}}),this.instructionMap.set(151,{name:"SUB A",cycleTime:4,operation:function(){e.registers.subtract(e.registers.A)}}),this.instructionMap.set(152,{name:"SBC A, B",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.B)}}),this.instructionMap.set(153,{name:"SBC A, C",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.C)}}),this.instructionMap.set(154,{name:"SBC A, D",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.D)}}),this.instructionMap.set(155,{name:"SBC A, E",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.E)}}),this.instructionMap.set(156,{name:"SBC A, H",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.H)}}),this.instructionMap.set(157,{name:"SBC A, L",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.L)}}),this.instructionMap.set(158,{name:"SBC A, (HL)",cycleTime:8,operation:function(){e.registers.subtractWithCarryFromMemory(e.registers.HL)}}),this.instructionMap.set(159,{name:"SBC A, A",cycleTime:4,operation:function(){e.registers.subtractWithCarry(e.registers.A)}}),this.instructionMap.set(160,{name:"AND B",cycleTime:4,operation:function(){e.registers.and(e.registers.B)}}),this.instructionMap.set(161,{name:"AND C",cycleTime:4,operation:function(){e.registers.and(e.registers.C)}}),this.instructionMap.set(162,{name:"AND D",cycleTime:4,operation:function(){e.registers.and(e.registers.D)}}),this.instructionMap.set(163,{name:"AND E",cycleTime:4,operation:function(){e.registers.and(e.registers.E)}}),this.instructionMap.set(164,{name:"AND H",cycleTime:4,operation:function(){e.registers.and(e.registers.H)}}),this.instructionMap.set(165,{name:"AND L",cycleTime:4,operation:function(){e.registers.and(e.registers.L)}}),this.instructionMap.set(166,{name:"AND (HL)",cycleTime:8,operation:function(){e.registers.andFromMemory(e.registers.HL)}}),this.instructionMap.set(167,{name:"AND A",cycleTime:4,operation:function(){e.registers.and(e.registers.A)}}),this.instructionMap.set(168,{name:"XOR B",cycleTime:4,operation:function(){e.registers.xor(e.registers.B)}}),this.instructionMap.set(169,{name:"XOR C",cycleTime:4,operation:function(){e.registers.xor(e.registers.C)}}),this.instructionMap.set(170,{name:"XOR D",cycleTime:4,operation:function(){e.registers.xor(e.registers.D)}}),this.instructionMap.set(171,{name:"XOR E",cycleTime:4,operation:function(){e.registers.xor(e.registers.E)}}),this.instructionMap.set(172,{name:"XOR H",cycleTime:4,operation:function(){e.registers.xor(e.registers.H)}}),this.instructionMap.set(173,{name:"XOR L",cycleTime:4,operation:function(){e.registers.xor(e.registers.L)}}),this.instructionMap.set(174,{name:"XOR (HL)",cycleTime:8,operation:function(){e.registers.xorFromMemory(e.registers.HL)}}),this.instructionMap.set(175,{name:"XOR A",cycleTime:4,operation:function(){e.registers.xor(e.registers.A)}}),this.instructionMap.set(176,{name:"OR B",cycleTime:4,operation:function(){e.registers.or(e.registers.B)}}),this.instructionMap.set(177,{name:"OR C",cycleTime:4,operation:function(){e.registers.or(e.registers.C)}}),this.instructionMap.set(178,{name:"OR D",cycleTime:4,operation:function(){e.registers.or(e.registers.D)}}),this.instructionMap.set(179,{name:"OR E",cycleTime:4,operation:function(){e.registers.or(e.registers.E)}}),this.instructionMap.set(180,{name:"OR H",cycleTime:4,operation:function(){e.registers.or(e.registers.H)}}),this.instructionMap.set(181,{name:"OR L",cycleTime:4,operation:function(){e.registers.or(e.registers.L)}}),this.instructionMap.set(182,{name:"OR (HL)",cycleTime:8,operation:function(){e.registers.orFromMemory(e.registers.HL)}}),this.instructionMap.set(183,{name:"OR A",cycleTime:4,operation:function(){e.registers.or(e.registers.A)}}),this.instructionMap.set(184,{name:"CP B",cycleTime:4,operation:function(){e.registers.compare(e.registers.B)}}),this.instructionMap.set(185,{name:"CP C",cycleTime:4,operation:function(){e.registers.compare(e.registers.C)}}),this.instructionMap.set(186,{name:"CP D",cycleTime:4,operation:function(){e.registers.compare(e.registers.D)}}),this.instructionMap.set(187,{name:"CP E",cycleTime:4,operation:function(){e.registers.compare(e.registers.E)}}),this.instructionMap.set(188,{name:"CP H",cycleTime:4,operation:function(){e.registers.compare(e.registers.H)}}),this.instructionMap.set(189,{name:"CP L",cycleTime:4,operation:function(){e.registers.compare(e.registers.L)}}),this.instructionMap.set(190,{name:"CP (HL)",cycleTime:8,operation:function(){e.registers.compareFromRegisterAddr(e.registers.HL)}}),this.instructionMap.set(191,{name:"CP A",cycleTime:4,operation:function(){e.registers.compare(e.registers.A)}}),this.instructionMap.set(192,{name:"RET NZ",get cycleTime(){return t.F.zero?8:20},operation:function(){e.registers.returnFromFunctionIfNotZero()}}),this.instructionMap.set(193,{name:"POP BC",cycleTime:12,operation:function(){e.registers.popToRegister(e.registers.BC)}}),this.instructionMap.set(194,{get name(){return"JP NZ, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.zero?12:16},operation:function(){e.registers.jumpIfNotZero()}}),this.instructionMap.set(195,{get name(){return"JP 0x".concat(i.readWord(t.PC.value).toString(16))},cycleTime:16,operation:function(){e.registers.jump()}}),this.instructionMap.set(196,{get name(){return"CALL NZ, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.zero?12:24},operation:function(){e.registers.callFunctionIfNotZero()}}),this.instructionMap.set(197,{name:"PUSH BC",cycleTime:16,operation:function(){e.registers.pushFromRegister(e.registers.BC)}}),this.instructionMap.set(198,{get name(){return"ADD A, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.addImmediate(e.registers.A)}}),this.instructionMap.set(199,{name:"RST 00H",cycleTime:16,operation:function(){e.registers.restart(0)}}),this.instructionMap.set(200,{name:"RET Z",get cycleTime(){return t.F.zero?20:8},operation:function(){e.registers.returnFromFunctionIfZero()}}),this.instructionMap.set(201,{name:"RET",cycleTime:16,operation:function(){e.registers.returnFromFunction()}}),this.instructionMap.set(202,{get name(){return"JP Z, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.zero?16:12},operation:function(){e.registers.jumpIfZero()}}),this.instructionMap.set(203,{name:"PREFIX CB",cycleTime:0,operation:function(){}}),this.instructionMap.set(204,{get name(){return"CALL Z, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.zero?24:12},operation:function(){e.registers.callFunctionIfZero()}}),this.instructionMap.set(205,{get name(){return"CALL 0x".concat(i.readWord(t.PC.value).toString(16))},cycleTime:24,operation:function(){e.registers.callFunction()}}),this.instructionMap.set(206,{get name(){return"ADC A, 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.addWithCarryImmediate()}}),this.instructionMap.set(207,{name:"RST 08H",cycleTime:16,operation:function(){e.registers.restart(8)}}),this.instructionMap.set(208,{name:"RET NC",get cycleTime(){return t.F.carry?8:20},operation:function(){e.registers.returnFromFunctionIfNotCarry()}}),this.instructionMap.set(209,{name:"POP DE",cycleTime:12,operation:function(){e.registers.popToRegister(e.registers.DE)}}),this.instructionMap.set(210,{get name(){return"JP NC 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.carry?12:16},operation:function(){e.registers.jumpIfNotCarry()}}),this.instructionMap.set(212,{get name(){return"CALL NC, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.carry?12:24},operation:function(){e.registers.callFunctionIfNotCarry()}}),this.instructionMap.set(213,{name:"PUSH DE",cycleTime:16,operation:function(){e.registers.pushFromRegister(e.registers.DE)}}),this.instructionMap.set(214,{get name(){return"SUB 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.subtractImmediate()}}),this.instructionMap.set(215,{name:"RST 10H",cycleTime:16,operation:function(){e.registers.restart(16)}}),this.instructionMap.set(216,{name:"RET C",get cycleTime(){return t.F.carry?20:8},operation:function(){e.registers.returnFromFunctionIfCarry()}}),this.instructionMap.set(217,{name:"RETI",cycleTime:16,operation:function(){e.registers.returnFromFunction(),e.interruptMasterEnabled=!0}}),this.instructionMap.set(218,{get name(){return"JP C, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.carry?16:12},operation:function(){e.registers.jumpIfCarry()}}),this.instructionMap.set(220,{get name(){return"CALL C, 0x".concat(i.readWord(t.PC.value).toString(16))},get cycleTime(){return t.F.carry?24:12},operation:function(){e.registers.callFunctionIfCarry()}}),this.instructionMap.set(222,{get name(){return"SBC A, ".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.subtractWithCarryImmediate()}}),this.instructionMap.set(223,{name:"RST 18H",cycleTime:16,operation:function(){e.registers.restart(24)}}),this.instructionMap.set(224,{get name(){return"LDH (0xff00 + 0x".concat(i.readByte(t.PC.value).toString(16),"), A")},cycleTime:0,operation:function(){e.registers.writeToMemory8Bit(e.registers.A)}}),this.instructionMap.set(225,{name:"POP HL",cycleTime:12,operation:function(){e.registers.popToRegister(e.registers.HL)}}),this.instructionMap.set(226,{name:"LDH (C), A",cycleTime:8,operation:function(){e.registers.writeToMemoryRegisterAddr8bit(e.registers.C,e.registers.A)}}),this.instructionMap.set(229,{name:"PUSH HL",cycleTime:16,operation:function(){e.registers.pushFromRegister(e.registers.HL)}}),this.instructionMap.set(230,{get name(){return"AND 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.andImmediate()}}),this.instructionMap.set(231,{name:"RST 20H",cycleTime:16,operation:function(){e.registers.restart(32)}}),this.instructionMap.set(232,{get name(){return"ADD SP, 0x".concat(i.readSignedByte(t.PC.value).toString(16))},cycleTime:16,operation:function(){e.registers.addImmediateSigned(e.registers.SP)}}),this.instructionMap.set(233,{name:"JP (HL)",cycleTime:4,operation:function(){e.registers.jumpToRegisterAddr()}}),this.instructionMap.set(234,{get name(){return"LD (".concat(i.readWord(t.PC.value).toString(16),"), A")},cycleTime:0,operation:function(){e.registers.writeToMemory16bit(e.registers.A)}}),this.instructionMap.set(238,{get name(){return"XOR 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.xorImmediate()}}),this.instructionMap.set(239,{name:"RST 28H",cycleTime:16,operation:function(){e.registers.restart(40)}}),this.instructionMap.set(240,{get name(){return"LDH A, (0x".concat(i.readByte(t.PC.value).toString(16),")")},cycleTime:0,operation:function(){e.registers.loadFromBase(e.registers.A)}}),this.instructionMap.set(241,{name:"POP AF",cycleTime:12,operation:function(){e.registers.popToRegister(e.registers.AF)}}),this.instructionMap.set(242,{name:"LD A, (C)",cycleTime:8,operation:function(){e.registers.loadByte8Bit(e.registers.A,e.registers.C)}}),this.instructionMap.set(243,{name:"DI",cycleTime:4,operation:function(){e.interruptMasterEnabled=!1}}),this.instructionMap.set(245,{name:"PUSH AF",cycleTime:16,operation:function(){e.registers.pushFromRegister(e.registers.AF)}}),this.instructionMap.set(246,{get name(){return"OR ".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.orImmediate()}}),this.instructionMap.set(247,{name:"RST 30H",cycleTime:16,operation:function(){e.registers.restart(48)}}),this.instructionMap.set(248,{get name(){return"LD HL, SP + 0x".concat(i.readSignedByte(t.PC.value).toString(16))},cycleTime:12,operation:function(){e.registers.loadHLStackPointer()}}),this.instructionMap.set(249,{name:"LD SP, HL",cycleTime:8,operation:function(){e.registers.load(e.registers.SP,e.registers.HL)}}),this.instructionMap.set(250,{get name(){return"LD A, (0x".concat(i.readWord(t.PC.value).toString(16),")")},cycleTime:0,operation:function(){e.registers.loadFrom16bitAddr(e.registers.A)}}),this.instructionMap.set(251,{name:"EI",cycleTime:4,operation:function(){e.interruptMasterEnabled=!0}}),this.instructionMap.set(254,{get name(){return"CP 0x".concat(i.readByte(t.PC.value).toString(16))},cycleTime:8,operation:function(){e.registers.compareImmediate()}}),this.instructionMap.set(255,{name:"RST 38H",cycleTime:16,operation:function(){e.registers.restart(56)}})}s.setInstructionMap=l}),define("cpu/CPU",["require","exports","Gameboy","misc/BitOperations","cpu/CPURegisters","cpu/setCbMap","cpu/setInstructionMap"],function(v,s,l,e,n,t,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.CPU=void 0;var a=64,g=72,c=80,h=88,o=96,r=function(){function u(f,R,b){this.isStopped=!1,this.isHalted=!1,this.interruptMasterEnabled=!0,this.setInstructionMap=i.setInstructionMap,this.setCbMap=t.setCbMap,this.instructionMap=new Map,this.cbMap=new Map,this.counter=0,this.timerCycles=0,this.isDoubleSpeed=!1,this.registers=new n.CPURegisters(f,this),this.memory=f,this.gpu=R,this.apu=b,this.setInstructionMap(),this.setCbMap()}return u.prototype.loadCartridge=function(f){var R=new DataView(f),b=this.memory.loadCartridge(R);return this.initialize(),b},u.prototype.initialize=function(){this.memory.reset(),this.registers.initialize(),l.Gameboy.frames=0},u.prototype.updateTimers=function(f){var R=this.registers,b=R.timerControlRegister,m=R.dividerRegister,T=R.timerCounterRegister,d=R.interruptRequestRegister,p=R.timerModuloRegister;this.counter=this.counter+f&65535;var y=this.counter>>8&255;if(m.overrideValue=y,!!b.isTimerEnabled())for(this.timerCycles+=f;this.timerCycles>=b.getClockFrequency();)this.timerCycles-=b.getClockFrequency(),T.value===255?(d.triggerTimerRequest(),T.value=p.value):T.value++},u.prototype.checkInterrupts=function(){var f=this.registers,R=f.interruptRequestRegister,b=f.interruptEnableRegister,m=b.value&R.value;m>0&&(this.isHalted=!1),this.interruptMasterEnabled&&(b.isVBlankInterruptEnabled()&&R.vBlankInterruptRequest()?(R.clearVBlankRequest(),this.registers.pushToStack(this.registers.PC.value),this.registers.PC.value=a,this.interruptMasterEnabled=!1):b.isLCDStatInterruptEnabled()&&R.lcdStatInterruptRequest()?(this.registers.pushToStack(this.registers.PC.value),R.clearLcdStatRequest(),this.registers.PC.value=g,this.interruptMasterEnabled=!1):b.isTimerInterruptEnabled()&&R.timerInterruptRequest()?(this.registers.pushToStack(this.registers.PC.value),R.clearTimerRequest(),this.registers.PC.value=c,this.interruptMasterEnabled=!1):b.isSerialInterruptEnabled()&&R.serialInterruptRequest()?(this.registers.pushToStack(this.registers.PC.value),R.clearSerialRequest(),this.registers.PC.value=h,this.interruptMasterEnabled=!1):b.isJoypadInterruptEnabled()&&R.joypadInterruptRequest()&&(this.registers.pushToStack(this.registers.PC.value),R.clearJoypadRequest(),this.registers.PC.value=o,this.interruptMasterEnabled=!1))},u.prototype.checkIfDoubleSpeed=function(){var f=this.memory.readByte(65357);(0,e.getBit)(f,7)===1?this.isDoubleSpeed=!0:this.isDoubleSpeed=!1},u.prototype.performCbInstruction=function(){var f=this.memory.readByte(this.registers.PC.value),R=this.cbMap.get(f);if(R==null)throw new Error("Invalid CB op code: 0x".concat(f.toString(16)));var b=this.registers.PC.hexValue;return this.registers.PC.value++,l.Gameboy.shouldOutputLogs&&console.log("found instruction ".concat(R.name," with code 0x").concat(f.toString(16)," at address ").concat(b)),R.operation(),R.cycleTime},u.prototype.tick=function(){try{var f=this.memory.readByte(this.registers.PC.value),R=this.instructionMap.get(f);if(R!=null){var b=this.registers.PC.hexValue;this.registers.PC.value++,l.Gameboy.shouldOutputLogs&&console.log("found instruction ".concat(R.name," with code 0x").concat(f.toString(16)," at address ").concat(b)),R.operation();var m=R.cycleTime;return R.name==="PREFIX CB"&&this.performCbInstruction(),this.isDoubleSpeed&&(m=m/2),m}else throw new Error("invalid instruction code: 0x".concat(f.toString(16).toUpperCase()))}catch(T){throw console.log("execution failed at frame ".concat(l.Gameboy.frames)),T}},u.prototype.cycle=function(f){this.updateTimers(f),this.gpu.tick(f),this.apu.tick(f)},u.prototype.step=function(){if(this.checkInterrupts(),this.checkIfDoubleSpeed(),this.isHalted)return this.cycle(4),4;var f=this.tick();return f!==0&&this.cycle(f),f},u}();s.CPU=r}),define("joypad/Joypad",["require","exports","cpu/memory_registers/JoypadRegister"],function(v,s,l){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Joypad=void 0;var e;(function(t){t[t.A=0]="A",t[t.B=1]="B",t[t.X=2]="X",t[t.Y=3]="Y",t[t.LB=4]="LB",t[t.RB=5]="RB",t[t.LT=6]="LT",t[t.RT=7]="RT",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.L3=10]="L3",t[t.R3=11]="R3",t[t.Up=12]="Up",t[t.Down=13]="Down",t[t.Left=14]="Left",t[t.Right=15]="Right"})(e||(e={}));var n=s.Joypad=function(){function t(i){this.gamepad=i}return t.handleInput=function(){var i=navigator.getGamepads()[0],a=new t(i);l.joypadRegister.isPressingLeft=a.isPressingLeft(),l.joypadRegister.isPressingRight=a.isPressingRight(),l.joypadRegister.isPressingDown=a.isPressingDown(),l.joypadRegister.isPressingUp=a.isPressingUp(),l.joypadRegister.isPressingA=a.isPressingA(),l.joypadRegister.isPressingB=a.isPressingB(),l.joypadRegister.isPressingSelect=a.isPressingSelect(),l.joypadRegister.isPressingStart=a.isPressingStart()},t.prototype.isPressingLeft=function(){var i,a,g=((i=this.gamepad)===null||i===void 0?void 0:i.axes[0])||0;return((a=this.gamepad)===null||a===void 0?void 0:a.buttons[e.Left].pressed)||g<-.1||t.isLeftKeyPressed},t.prototype.isPressingRight=function(){var i,a,g,c=((i=this.gamepad)===null||i===void 0?void 0:i.axes[0])||0;return((g=(a=this.gamepad)===null||a===void 0?void 0:a.buttons[e.Right])===null||g===void 0?void 0:g.pressed)||c>.1||t.isRightKeyPressed},t.prototype.isPressingUp=function(){var i,a,g=((i=this.gamepad)===null||i===void 0?void 0:i.axes[1])||0;return((a=this.gamepad)===null||a===void 0?void 0:a.buttons[e.Up].pressed)||g<-.1||t.isUpKeyPressed},t.prototype.isPressingDown=function(){var i,a,g=((i=this.gamepad)===null||i===void 0?void 0:i.axes[1])||0;return((a=this.gamepad)===null||a===void 0?void 0:a.buttons[e.Down].pressed)||g>.1||t.isDownKeyPressed},t.prototype.isPressingA=function(){var i;return((i=this.gamepad)===null||i===void 0?void 0:i.buttons[e.A].pressed)||t.isSKeyPressed},t.prototype.isPressingB=function(){var i;return((i=this.gamepad)===null||i===void 0?void 0:i.buttons[e.X].pressed)||t.isAKeyPressed},t.prototype.isPressingStart=function(){var i;return((i=this.gamepad)===null||i===void 0?void 0:i.buttons[e.Start].pressed)||t.isEnterKeyPressed},t.prototype.isPressingSelect=function(){var i;return((i=this.gamepad)===null||i===void 0?void 0:i.buttons[e.Select].pressed)||t.isShiftKeyPressed},t.isUpKeyPressed=!1,t.isDownKeyPressed=!1,t.isRightKeyPressed=!1,t.isLeftKeyPressed=!1,t.isEnterKeyPressed=!1,t.isShiftKeyPressed=!1,t.isSKeyPressed=!1,t.isAKeyPressed=!1,t}()}),define("Gameboy",["require","exports","apu/APU","cpu/CPU","cpu/Memory","gpu/GPU","joypad/Joypad"],function(v,s,l,e,n,t,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.Gameboy=void 0;var a=new n.Memory,g=60,c=1e3/g,h=s.Gameboy=function(){function o(){this.gpu=new t.GPU(a),this.cpu=new e.CPU(a,this.gpu,new l.APU(a)),this.fps=0,this.cycles=0,this.previousTime=0,this.isRunning=!0}return o.prototype.loadCartridge=function(r){var u=this.cpu.loadCartridge(r);this.gpu.isGBC=u},o.prototype.run=function(){var r=this,u,f=(u=document.querySelector("canvas"))===null||u===void 0?void 0:u.getContext("2d");if(this.initializeKeyboardInputs(),f!=null)requestAnimationFrame(function(R){return r.execute(R,f)});else throw new Error("canvas context is null!")},o.prototype.initializeKeyboardInputs=function(){document.addEventListener("keyup",function(r){switch(r.preventDefault(),r.key){case"ArrowDown":i.Joypad.isDownKeyPressed=!1;break;case"ArrowUp":i.Joypad.isUpKeyPressed=!1;break;case"ArrowLeft":i.Joypad.isLeftKeyPressed=!1;break;case"ArrowRight":i.Joypad.isRightKeyPressed=!1;break;case"Enter":i.Joypad.isEnterKeyPressed=!1;break;case"Shift":i.Joypad.isShiftKeyPressed=!1;break;case"s":i.Joypad.isSKeyPressed=!1;break;case"a":i.Joypad.isAKeyPressed=!1;break}}),document.addEventListener("keydown",function(r){switch(r.preventDefault(),r.key){case"ArrowDown":i.Joypad.isDownKeyPressed=!0;break;case"ArrowUp":i.Joypad.isUpKeyPressed=!0;break;case"ArrowLeft":i.Joypad.isLeftKeyPressed=!0;break;case"ArrowRight":i.Joypad.isRightKeyPressed=!0;break;case"Enter":i.Joypad.isEnterKeyPressed=!0;break;case"Shift":i.Joypad.isShiftKeyPressed=!0;break;case"s":i.Joypad.isSKeyPressed=!0;break;case"a":i.Joypad.isAKeyPressed=!0;break}})},o.prototype.execute=function(r,u){var f=this,R=r-this.previousTime;if(R>=c||this.previousTime===0){for(this.fps=1e3/R,this.previousTime=r-R%c;this.cycles<=t.GPU.CyclesPerFrame;)this.cycles+=this.cpu.step();i.Joypad.handleInput(),u.putImageData(this.gpu.screen,0,0),o.frames++,this.cycles%=t.GPU.CyclesPerFrame}this.isRunning&&requestAnimationFrame(function(b){return f.execute(b,u)})},o.frames=0,o.shouldOutputLogs=!1,o}()}),define("apu/channels/StereoChannel",["require","exports"],function(v,s){"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.StereoChannel=void 0;var l;(function(e){e[e.Left=0]="Left",e[e.Right=1]="Right"})(l||(s.StereoChannel=l={}))});
